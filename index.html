<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä»Šå¤©åƒä»€éº¼ï¼Ÿ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* è«è˜­è¿ªè‰²ç³» */
            --bg: #F0F2F0;
            --card-bg: #FFFFFF;
            --primary: #7A9CA5;      /* ç°è—ç¶  */
            --secondary: #8DA399;    /* é¼ å°¾è‰ç¶  */
            --accent: #D6A2A2;       /* è«è˜­è¿ªç²‰ */
            --text: #4A5559;
            --text-light: #9DA7AA;
            --shadow: 0 10px 30px rgba(122, 156, 165, 0.15);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body {
            margin: 0; padding: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg); color: var(--text);
            height: 100vh; display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* é ‚éƒ¨å°èˆª */
        .header {
            padding: 20px; text-align: center;
            background: var(--bg);
            z-index: 10;
        }
        .app-title { font-size: 20px; font-weight: bold; letter-spacing: 2px; color: var(--primary); }
        .subtitle { font-size: 12px; color: var(--text-light); margin-top: 5px; }

        /* ä¸»ç•«é¢å®¹å™¨ */
        .main-container {
            flex: 1; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 20px; position: relative;
        }

        /* ç¾é£Ÿå¡ç‰‡ */
        .food-card {
            background: var(--card-bg);
            width: 100%; max-width: 360px;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
            transition: transform 0.3s ease, opacity 0.3s ease;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .food-img {
            width: 100%; height: 280px; object-fit: cover;
            background-color: #eee;
        }
        
        .food-info { padding: 25px; text-align: center; }
        .food-name { font-size: 26px; font-weight: bold; margin-bottom: 8px; color: var(--text); }
        .food-tags { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .tag { font-size: 12px; padding: 4px 10px; border-radius: 12px; background: #F4F6F4; color: var(--secondary); }
        .price-tag { color: var(--text-light); font-size: 14px; }

        /* åº•éƒ¨æŒ‰éˆ•å€ */
        .action-bar {
            padding: 0 20px 40px;
            display: flex; justify-content: center; gap: 30px;
            width: 100%; max-width: 400px; margin: 0 auto;
        }

        .btn-circle {
            width: 70px; height: 70px; border-radius: 50%;
            border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .btn-circle:active { transform: scale(0.9); }
        
        .btn-reject { background: #FFFFFF; color: var(--accent); }
        .btn-accept { background: var(--primary); color: white; box-shadow: 0 8px 20px rgba(122, 156, 165, 0.4); }

        /* æ‹’çµ•åŸå› å½ˆçª— */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            display: none; justify-content: center; align-items: flex-end;
            z-index: 100;
        }
        .modal-overlay.open { display: flex; animation: fadeIn 0.2s; }
        
        .reason-sheet {
            background: white; width: 100%; max-width: 500px;
            border-radius: 24px 24px 0 0; padding: 30px 20px 50px;
            animation: slideUp 0.3s;
        }
        .sheet-title { font-size: 18px; font-weight: bold; text-align: center; margin-bottom: 20px; }
        
        .reason-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .reason-btn {
            padding: 15px; border: 1px solid #eee; border-radius: 12px;
            background: #FAFAFA; color: var(--text); font-size: 15px;
            text-align: center; cursor: pointer;
        }
        .reason-btn:active { background: var(--bg); border-color: var(--primary); }

        /* æˆåŠŸç•«é¢ */
        .success-view {
            display: none; flex-direction: column; align-items: center;
            text-align: center; width: 100%; max-width: 360px;
            animation: fadeIn 0.5s;
        }
        .success-view.show { display: flex; }
        
        .success-icon { 
            font-size: 60px; color: var(--primary); margin-bottom: 20px; 
            animation: bounce 1s infinite;
        }
        .map-btn {
            margin-top: 20px; width: 100%; padding: 16px;
            background: var(--primary); color: white; border: none;
            border-radius: 16px; font-size: 16px; font-weight: bold;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            text-decoration: none;
        }

        /* Loading */
        .loading-view { display: none; text-align: center; }
        .loading-view.show { display: block; }
        .spinner { font-size: 40px; color: var(--secondary); animation: spin 1s linear infinite; }

        /* å‹•ç•« */
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* ç¯©é¸æ¨™ç±¤é¡¯ç¤º */
        .filter-status {
            position: absolute; top: 70px; left: 0; right: 0; text-align: center;
            font-size: 12px; color: var(--accent); opacity: 0.8; height: 20px;
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="app-title">ä»Šå¤©åƒä»€éº¼ï¼Ÿ</div>
        <div class="subtitle">å°ˆå±¬ä½ çš„ç¾é£Ÿé¡§å•</div>
    </div>

    <!-- ç¯©é¸ç‹€æ…‹æç¤º -->
    <div id="filterStatus" class="filter-status"></div>

    <div class="main-container">
        <!-- Loading -->
        <div id="loading" class="loading-view">
            <i class="fas fa-compass spinner"></i>
            <p style="margin-top:15px; color:#888;">æ­£åœ¨æœå°‹é™„è¿‘ç¾é£Ÿ...</p>
        </div>

        <!-- æ±ºå®šå¥½çš„çµæœ -->
        <div id="successView" class="success-view">
            <div class="success-icon"><i class="fas fa-check-circle"></i></div>
            <h2 style="margin:0;">æ±ºå®šå°±æ˜¯å®ƒäº†ï¼</h2>
            <div class="food-card" style="margin-top:20px; transform: scale(0.95);">
                <img id="resImg" class="food-img">
                <div class="food-info">
                    <div id="resName" class="food-name"></div>
                    <div class="price-tag" id="resPrice"></div>
                </div>
            </div>
            <a id="mapLink" href="#" target="_blank" class="map-btn">
                <i class="fas fa-location-arrow"></i> Google Maps å°èˆª
            </a>
            <div style="margin-top:15px; color:#999; font-size:14px;" onclick="resetApp()">å†é¸ä¸€æ¬¡</div>
        </div>

        <!-- æ¨è–¦å¡ç‰‡ -->
        <div id="cardView" class="food-card">
            <img id="cardImg" class="food-img" src="" alt="Food">
            <div class="food-info">
                <div id="cardName" class="food-name">è¼‰å…¥ä¸­...</div>
                <div id="cardTags" class="food-tags">
                    <!-- JS ç”Ÿæˆ -->
                </div>
                <div id="cardPrice" class="price-tag"></div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨æŒ‰éˆ• -->
    <div id="actionBar" class="action-bar">
        <button class="btn-circle btn-reject" onclick="openReasonModal()">
            <i class="fas fa-times"></i>
        </button>
        <button class="btn-circle btn-accept" onclick="acceptFood()">
            <i class="fas fa-heart"></i>
        </button>
    </div>

    <!-- æ‹’çµ•åŸå› å½ˆçª— -->
    <div id="reasonModal" class="modal-overlay" onclick="if(event.target===this) closeReasonModal()">
        <div class="reason-sheet">
            <div class="sheet-title">ç‚ºä»€éº¼ä¸æƒ³åƒé€™å€‹ï¼Ÿ ğŸ¤”</div>
            <div class="reason-grid">
                <div class="reason-btn" onclick="rejectWithReason('expensive')">ğŸ’¸ å¤ªè²´äº†</div>
                <div class="reason-btn" onclick="rejectWithReason('heavy')">ğŸ– å¤ªæ²¹è†©/æƒ³åƒæ¸…æ·¡</div>
                <div class="reason-btn" onclick="rejectWithReason('far')">ğŸš¶ å¤ªé äº†/æ‡¶å¾—èµ°</div>
                <div class="reason-btn" onclick="rejectWithReason('spicy')">ğŸŒ¶ï¸ ä¸æƒ³åƒè¾£</div>
                <div class="reason-btn" onclick="rejectWithReason('carb')">ğŸœ ä¸æƒ³åƒéºµ/é£¯</div>
                <div class="reason-btn" onclick="rejectWithReason('feeling')">ğŸ˜‘ æ²’æ„Ÿè¦ºï¼Œæ›ä¸€å€‹</div>
            </div>
        </div>
    </div>

    <script>
        // === 1. è±ªè¯ç‰ˆç¾é£Ÿè³‡æ–™åº« (50+ é¸é …) ===
        const database = [
            // --- å°å¼ & å°åƒ ---
            { name: "æ»·è‚‰é£¯ + ç‡™é’èœ", price: 1, tags: ["å°å¼", "é£¯", "ç¶“å…¸"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1627207644063-267926715201?w=600" },
            { name: "ç´…ç‡’ç‰›è‚‰éºµ", price: 2, tags: ["å°å¼", "éºµé£Ÿ", "æ¹¯"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1596458397260-255551c09534?w=600" },
            { name: "å··å£ä¹¾éºµ + æ»·å‘³", price: 1, tags: ["å°å¼", "éºµé£Ÿ", "ä¾¿å®œ"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1552611052-33e04de081de?w=600" },
            { name: "å¤§é›æ’ + çå¥¶", price: 1, tags: ["å°å¼", "ç‚¸ç‰©", "ç½ªæƒ¡"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600" },
            { name: "è„†çš®è‡­è±†è…", price: 1, tags: ["å°å¼", "å°åƒ", "é…¥è„†"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1583069358212-04e8d89ce58a?w=600" },
            { name: "èšµä»”ç…", price: 1, tags: ["å°å¼", "å¤œå¸‚", "æµ·é®®"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?w=600" },
            { name: "æ¸…ç²¥å°èœ", price: 2, tags: ["å°å¼", "æ¸…æ·¡", "å®µå¤œ"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1516684732738-16fa2021c179?w=600" },
            { name: "å°å¼ç†±ç‚’", price: 2, tags: ["å°å¼", "èšé¤", "å•¤é…’"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1551249721-a4b51cc13075?w=600" },
            { name: "å˜‰ç¾©ç«é›è‚‰é£¯", price: 1, tags: ["å°å¼", "é£¯", "å®¶é„‰å‘³"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1606525437679-037aca74a3e9?w=600" },
            { name: "æº«å·å¤§é¤›é£©", price: 1, tags: ["å°å¼", "éºµé£Ÿ", "å¤§ä»½é‡"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1596458397223-93c66f25459b?w=600" },
            { name: "æ¶¼éºµ + å‘³å™Œæ¹¯", price: 1, tags: ["å°å¼", "æ¸…çˆ½", "å¤å¤©"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1594975519808-8df04405362a?w=600" },
            { name: "æ½¤é¤…æ²", price: 1, tags: ["å°å¼", "æ¸…çˆ½", "è”¬èœ"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1609180746973-20739c381c8b?w=600" },
            { name: "éº»è¾£é´¨è¡€è‡­è±†è…", price: 1, tags: ["å°å¼", "æ¹¯", "è¾£"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1541280910158-c4e34faf2c00?w=600" },

            // --- æ—¥å¼æ–™ç† ---
            { name: "ä¸€è˜­æ‹‰éºµ", price: 2, tags: ["æ—¥å¼", "éºµé£Ÿ", "æ¹¯"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1591814468924-caf88d1232e1?w=600" },
            { name: "è—å£½å¸ / å£½å¸éƒ", price: 2, tags: ["æ—¥å¼", "æ¸…æ·¡", "æµ·é®®"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600" },
            { name: "æ—¥å¼è±¬æ’å®šé£Ÿ", price: 2, tags: ["æ—¥å¼", "ç‚¸ç‰©", "é£¯"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1616428467478-43d969248232?w=600" },
            { name: "ç‰›ä¸¼ (å‰é‡å®¶/Sukiya)", price: 1, tags: ["æ—¥å¼", "é£¯", "å¿«é€Ÿ"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1554502078-ef0fc409efce?w=600" },
            { name: "æ—¥å¼å’–å“©é£¯", price: 2, tags: ["æ—¥å¼", "æ¿ƒéƒ", "é£¯"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1604152135912-04a022e23696?w=600" },
            { name: "çƒé¾éºµ (ä¸¸äº€è£½éºµ)", price: 1, tags: ["æ—¥å¼", "éºµé£Ÿ", "Qå½ˆ"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=600" },
            { name: "æ—¥å¼ç‡’è‚‰ (åƒåˆ°é£½)", price: 3, tags: ["æ—¥å¼", "è‚‰", "èšé¤"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1592685829283-7c0bb77df3c9?w=600" },
            { name: "å±…é…’å±‹ä¸²ç‡’", price: 3, tags: ["æ—¥å¼", "å–é…’", "å®µå¤œ"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1534604973900-c43ab4c2e0ab?w=600" },
            { name: "ç”Ÿé­šç‰‡ä¸¼é£¯", price: 3, tags: ["æ—¥å¼", "ç”Ÿé£Ÿ", "è±ªè¯"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1562436260-8c9216eeb703?w=600" },
            { name: "å¤©å©¦ç¾…ä¸¼", price: 2, tags: ["æ—¥å¼", "ç‚¸ç‰©", "é£¯"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1560155016-16e6c1cc3e53?w=600" },
            { name: "å¤§é˜ªç‡’ / ç« é­šç‡’", price: 2, tags: ["æ—¥å¼", "éµæ¿", "é»å¿ƒ"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1563489851-9040854d9203?w=600" },

            // --- è¥¿å¼ & é€Ÿé£Ÿ ---
            { name: "éº¥ç•¶å‹", price: 1, tags: ["é€Ÿé£Ÿ", "æ¼¢å ¡", "å¿«æ¨‚"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=600" },
            { name: "è‚¯å¾·åŸº KFC", price: 1, tags: ["é€Ÿé£Ÿ", "ç‚¸é›", "è›‹å¡”"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600" },
            { name: "å¿…å‹å®¢ / é”ç¾æ¨‚", price: 2, tags: ["è¥¿å¼", "æŠ«è–©", "èšé¤"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=600" },
            { name: "Subway", price: 1, tags: ["è¥¿å¼", "è¼•é£Ÿ", "è”¬èœ"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1509722747741-092075b55909?w=600" },
            { name: "ç¾©å¤§åˆ©éºµ (Carbonara)", price: 2, tags: ["è¥¿å¼", "éºµé£Ÿ", "å¥¶é¦™"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?w=600" },
            { name: "ç¾å¼æ—©åˆé¤ (Brunch)", price: 2, tags: ["è¥¿å¼", "è›‹", "æ‚ é–’"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1533089862017-5614ecb3f2f2?w=600" },
            { name: "ç‰›æ’é¤¨ (Steak)", price: 3, tags: ["è¥¿å¼", "è‚‰", "é«˜ç´š"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1600891964092-4316c288032e?w=600" },
            { name: "ç¾å¼æ¼¢å ¡ (æ‰‹å·¥)", price: 2, tags: ["è¥¿å¼", "è‚‰", "é‡å£å‘³"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=600" },
            { name: "å‡±è–©æ²™æ‹‰ç›†", price: 2, tags: ["è¥¿å¼", "å¥åº·", "ç”Ÿèœ"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600" },
            { name: "ç‡‰é£¯ (Risotto)", price: 2, tags: ["è¥¿å¼", "é£¯", "æ¿ƒéƒ"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1476124369491-e7addf5db371?w=600" },

            // --- ç«é‹ & æ¹¯é¡ ---
            { name: "æµ·åº•æ’ˆç«é‹", price: 3, tags: ["ç«é‹", "æœå‹™", "èšé¤"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1582236357997-6a422a57ae22?w=600" },
            { name: "å€‹äººå°ç«é‹ (ä¸‰åª½/å¤§å‘¼)", price: 1, tags: ["ç«é‹", "ä¾¿å®œ", "ç†±æ¹¯"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1547592166-23acbe34071b?w=600" },
            { name: "éº»è¾£é‹åƒåˆ°é£½", price: 3, tags: ["ç«é‹", "è‚‰", "è¾£"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1605494236979-66c3070445df?w=600" },
            { name: "å£½å–œç‡’", price: 2, tags: ["æ—¥å¼", "ç«é‹", "è‚‰"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1584213123849-5f1118335914?w=600" },
            { name: "è–‘æ¯é´¨ / ç¾Šè‚‰çˆ", price: 2, tags: ["å°å¼", "é€²è£œ", "å†¬å¤©"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1616428467478-43d969248232?w=600" },

            // --- ç•°åœ‹ & å…¶ä»– ---
            { name: "éŸ“å¼ç‚¸é›", price: 2, tags: ["éŸ“å¼", "ç‚¸ç‰©", "ç”œè¾£"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600" },
            { name: "éŸ“å¼æ³¡èœé‹ / è±†è…é‹", price: 2, tags: ["éŸ“å¼", "æ¹¯", "è¾£"], heavy: false, spicy: true, img: "https://images.unsplash.com/photo-1596458397260-255551c09534?w=600" },
            { name: "çŸ³é‹æ‹Œé£¯", price: 2, tags: ["éŸ“å¼", "é£¯", "é‹å·´"], heavy: false, spicy: true, img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600" },
            { name: "æ³°å¼æ–™ç† (ç“¦åŸ/è·¯é‚Š)", price: 2, tags: ["æ³°å¼", "é…¸è¾£", "ä¸‹é£¯"], heavy: false, spicy: true, img: "https://images.unsplash.com/photo-1559314809-0d155014e29e?w=600" },
            { name: "è¶Šå—æ²³ç²‰ (Pho)", price: 1, tags: ["è¶Šå¼", "æ¸…çˆ½", "æ¹¯"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1582878826629-29b7ad1cdc43?w=600" },
            { name: "é¼æ³°è±å°ç± åŒ…", price: 3, tags: ["ä¸­å¼", "é»å¿ƒ", "ç²¾ç·»"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1563245372-f21724e3856d?w=600" },
            { name: "æ¸¯å¼é£²èŒ¶ (é»å¿ƒ)", price: 2, tags: ["æ¸¯å¼", "é»å¿ƒ", "èšé¤"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1541696490865-e6f720e9c195?w=600" },
            { name: "ç‡’è‡˜ä¾¿ç•¶", price: 1, tags: ["æ¸¯å¼", "è‚‰", "ä¾¿ç•¶"], heavy: true, spicy: false, img: "https://images.unsplash.com/photo-1552611052-33e04de081de?w=600" },
            { name: "å¥åº·æ°´ç…®é¤ç›’", price: 2, tags: ["å¥åº·", "ä½å¡", "æ¸…æ·¡"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600" },
            { name: "å°åº¦å’–å“© + çƒ¤é¤…", price: 2, tags: ["ç•°åœ‹", "æ¿ƒéƒ", "è¾£"], heavy: true, spicy: true, img: "https://images.unsplash.com/photo-1604152135912-04a022e23696?w=600" },
            { name: "å¤å¨å¤·æ‹Œé£¯ (Poke)", price: 2, tags: ["ç¾å¼", "æ¸…çˆ½", "æµ·é®®"], heavy: false, spicy: false, img: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=600" }
        ];

        // === 2. æ ¸å¿ƒé‚è¼¯ ===
        let currentPool = [...database]; // ç›®å‰å¯é¸çš„é¤å»³
        let currentFood = null; // ç•¶å‰é¡¯ç¤ºçš„é¤å»³
        let filters = []; // å·²å¥—ç”¨çš„éæ¿¾æ¢ä»¶

        function init() {
            pickRandomFood();
        }

        function pickRandomFood() {
            // æ¨¡æ“¬æœå°‹ä¸­çš„ Loading æ•ˆæœ
            document.getElementById('cardView').style.display = 'none';
            document.getElementById('loading').classList.add('show');
            document.getElementById('actionBar').style.opacity = '0';

            setTimeout(() => {
                document.getElementById('loading').classList.remove('show');
                
                if (currentPool.length === 0) {
                    alert("æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„é¤å»³äº†ï¼å°‡é‡ç½®æœå°‹æ¢ä»¶ã€‚");
                    resetApp();
                    return;
                }

                // éš¨æ©Ÿé¸ä¸€å€‹
                const randomIndex = Math.floor(Math.random() * currentPool.length);
                currentFood = currentPool[randomIndex];
                
                renderCard(currentFood);
                
                document.getElementById('cardView').style.display = 'block';
                document.getElementById('actionBar').style.opacity = '1';
                
                // å‹•ç•«é‡ç½®
                const card = document.getElementById('cardView');
                card.style.animation = 'none';
                card.offsetHeight; /* trigger reflow */
                card.style.animation = 'popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';

            }, 600); // å‡è£è·‘äº† 0.6 ç§’
        }

        function renderCard(food) {
            document.getElementById('cardImg').src = food.img;
            document.getElementById('cardName').innerText = food.name;
            
            // åƒ¹æ ¼é¡¯ç¤º
            let priceStr = "";
            for(let i=0; i<3; i++) {
                priceStr += i < food.price ? '<i class="fas fa-dollar-sign" style="color:#7A9CA5"></i>' : '<i class="fas fa-dollar-sign" style="color:#ddd"></i>';
            }
            document.getElementById('cardPrice').innerHTML = priceStr;

            // æ¨™ç±¤é¡¯ç¤º
            document.getElementById('cardTags').innerHTML = food.tags.map(t => `<span class="tag">#${t}</span>`).join('');
        }

        // æ‰“é–‹æ‹’çµ•é¸å–®
        function openReasonModal() {
            document.getElementById('reasonModal').classList.add('open');
        }
        function closeReasonModal() {
            document.getElementById('reasonModal').classList.remove('open');
        }

        // æ ¹æ“šåŸå› éæ¿¾
        function rejectWithReason(reason) {
            closeReasonModal();
            let filterText = "";

            // å¾åå–®ä¸­ç§»é™¤ç•¶å‰é€™å®¶
            currentPool = currentPool.filter(f => f.name !== currentFood.name);

            // é‚è¼¯ç¯©é¸
            if (reason === 'expensive') {
                currentPool = currentPool.filter(f => f.price < 3); // å»æ‰è²´çš„
                filterText = "éæ¿¾æ‰é«˜åƒ¹ä½...";
            }
            else if (reason === 'heavy') {
                currentPool = currentPool.filter(f => !f.heavy); // å»æ‰æ²¹è†©
                filterText = "å°‹æ‰¾æ¸…æ·¡å£å‘³...";
            }
            else if (reason === 'spicy') {
                currentPool = currentPool.filter(f => !f.spicy); // å»æ‰è¾£çš„
                filterText = "ä¸åƒè¾£...";
            }
            else if (reason === 'carb') {
                // ç°¡å–®ç¤ºç¯„ï¼šå»æ‰æ¨™ç±¤å«éºµæˆ–é£¯çš„
                currentPool = currentPool.filter(f => !f.tags.includes('éºµé£Ÿ') && !f.tags.includes('é£¯'));
                filterText = "ä¸æƒ³åƒéºµé£¯...";
            }
            else if (reason === 'far') {
                // å› ç‚ºæ²’æœ‰çœŸå¯¦è·é›¢ï¼Œéš¨æ©Ÿç§»é™¤ä¸€åŠï¼Œå‡è£å¤ªé  XD
                currentPool = currentPool.slice(0, Math.floor(currentPool.length / 2));
                filterText = "å°‹æ‰¾æ›´è¿‘çš„...";
            }
            else {
                filterText = "å°‹æ‰¾å…¶ä»–é¸æ“‡...";
            }

            // æ›´æ–° UI æç¤º
            const status = document.getElementById('filterStatus');
            status.innerText = filterText;
            status.style.opacity = 1;
            setTimeout(() => { status.style.opacity = 0.8; }, 2000);

            pickRandomFood();
        }

        // æ¥å—å»ºè­°
        function acceptFood() {
            document.getElementById('cardView').style.display = 'none';
            document.getElementById('actionBar').style.display = 'none';
            document.getElementById('successView').classList.add('show');
            document.getElementById('filterStatus').style.display = 'none';

            // å¡«å…¥æˆåŠŸç•«é¢è³‡æ–™
            document.getElementById('resImg').src = currentFood.img;
            document.getElementById('resName').innerText = currentFood.name;
            
            // è¨­å®š Google Maps é€£çµ
            // ä½¿ç”¨ encodeURIComponent ç¢ºä¿ä¸­æ–‡èƒ½æ­£ç¢ºæœå°‹
            document.getElementById('mapLink').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(currentFood.name)}`;
        }

        function resetApp() {
            currentPool = [...database];
            document.getElementById('successView').classList.remove('show');
            document.getElementById('cardView').style.display = 'block';
            document.getElementById('actionBar').style.display = 'flex';
            document.getElementById('filterStatus').innerText = "";
            document.getElementById('filterStatus').style.display = 'block';
            pickRandomFood();
        }

        init();

    </script>
</body>
</html>