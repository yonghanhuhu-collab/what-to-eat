<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä»Šå¤©åƒä»€éº¼ï¼ŸV4.1</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* è«è˜­è¿ª V4.1 */
            --bg: #F0F2F5;
            --card: #FFFFFF;
            --primary: #7A9CA5;
            --secondary: #A5B59C;
            --accent: #D68C8C;
            --text: #4A4A4A;
            --gray: #B0B0B0;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: 'Noto Sans TC', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            height: 100dvh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }

        /* === é–‹å ´å•å· === */
        .onboarding-layer {
            position: fixed; inset: 0; background: var(--bg); z-index: 300;
            padding: 30px 20px; display: flex; flex-direction: column; justify-content: center;
            transition: transform 0.4s ease;
        }
        .onboarding-layer.hidden { transform: translateY(-100%); pointer-events: none; }
        
        .q-step { display: none; animation: fadeIn 0.4s; height: 100%; flex-direction: column; justify-content: center; }
        .q-step.active { display: flex; }
        
        .q-title { font-size: 26px; font-weight: bold; margin-bottom: 40px; color: var(--primary); text-align: center; }
        .option-grid { display: grid; gap: 15px; }
        .option-btn {
            padding: 20px; background: white; border: 2px solid transparent;
            border-radius: 16px; font-size: 18px; font-weight: 500; text-align: center;
            box-shadow: var(--shadow); cursor: pointer; transition: all 0.1s;
        }
        .option-btn:active { background: #EBF2F5; border-color: var(--primary); transform: scale(0.98); }

        /* === Header === */
        .header { 
            padding: 10px 20px; z-index: 10; display: flex; 
            justify-content: space-between; align-items: center; 
            padding-top: max(10px, env(safe-area-inset-top));
            height: 50px; flex-shrink: 0;
        }
        .app-logo { font-size: 16px; font-weight: bold; color: var(--primary); letter-spacing: 1px; }
        .wishlist-counter {
            background: white; padding: 4px 12px; border-radius: 20px;
            font-size: 13px; font-weight: bold; color: var(--accent);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s;
        }
        .wishlist-counter.bump { transform: scale(1.2); }

        /* === ä¸»å¡ç‰‡å€ === */
        .main-stage {
            flex: 1; position: relative; width: 100%; max-width: 420px; margin: 0 auto;
            display: flex; flex-direction: column; 
            padding: 10px 20px 0 20px;
            overflow: hidden;
        }

        .browse-mode { display: flex; flex-direction: column; height: 100%; position: relative; }
        
        .food-card {
            background: var(--card); border-radius: 24px; overflow: hidden;
            box-shadow: var(--shadow); 
            flex: 1; 
            display: flex; flex-direction: column;
            position: relative; animation: popIn 0.3s; 
            margin-bottom: 20px;
            min-height: 0;
        }
        
        .food-img-box { 
            flex: 0 0 45%; position: relative; background: #eee; overflow: hidden;
        }
        .food-img { width: 100%; height: 100%; object-fit: cover; }
        .price-badge {
            position: absolute; bottom: 10px; right: 10px;
            background: rgba(255,255,255,0.95); color: var(--text); padding: 4px 10px;
            border-radius: 12px; font-size: 12px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .food-content { 
            padding: 20px; flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch;
        }
        .food-title { font-size: 24px; font-weight: bold; margin-bottom: 8px; color: var(--text); }
        .food-desc { font-size: 15px; color: #666; line-height: 1.5; margin-bottom: 15px; }
        
        .tag-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 15px; }
        .info-tag { background: #EDF2F4; padding: 4px 10px; border-radius: 8px; font-size: 12px; color: #666; }

        .filter-section { margin-top: 10px; padding-top: 15px; border-top: 1px dashed #eee; }
        .filter-title { font-size: 12px; font-weight: bold; color: var(--accent); margin-bottom: 8px; }
        .quick-actions { 
            display: flex; gap: 10px; overflow-x: auto; 
            padding-bottom: 5px; scrollbar-width: none; 
        }
        .quick-actions::-webkit-scrollbar { display: none; }
        
        .chip-btn { 
            white-space: nowrap; padding: 8px 14px; border-radius: 20px; 
            border: 1px solid #E0E0E0; background: white; color: #888; 
            font-size: 13px; flex-shrink: 0; transition: all 0.1s;
        }
        .chip-btn:active { background: #FFF0F0; border-color: var(--accent); color: var(--accent); }

        /* === åº•éƒ¨æŒ‰éˆ•å€ === */
        .bottom-controls {
            display: flex; justify-content: center; align-items: center; gap: 40px;
            padding: 0 30px;
            padding-bottom: max(30px, env(safe-area-inset-bottom)); 
            height: 100px; width: 100%; max-width: 400px; margin: 0 auto;
            flex-shrink: 0; z-index: 50;
        }
        
        .big-btn {
            width: 70px; height: 70px; border-radius: 50%; border: none;
            font-size: 28px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.1s;
        }
        .big-btn:active { transform: scale(0.9); }
        .btn-pass { background: white; color: var(--gray); border: 2px solid #F0F0F0; }
        .btn-keep { background: var(--accent); color: white; width: 80px; height: 80px; font-size: 32px; box-shadow: 0 8px 20px rgba(214, 140, 140, 0.4); }

        /* === æ±ºé¸èˆ‡æˆåŠŸ === */
        .full-screen-mode { 
            display: none; position: fixed; inset: 0; background: var(--bg); z-index: 50; 
            flex-direction: column; padding: 20px; padding-top: max(20px, env(safe-area-inset-top));
        }
        .full-screen-mode.show { display: flex; animation: fadeIn 0.3s; }

        .pk-container { flex: 1; overflow-y: auto; padding-bottom: 20px; }
        .pk-card {
            background: white; border-radius: 16px; padding: 15px; margin-bottom: 12px;
            display: flex; align-items: center; gap: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            cursor: pointer; border: 2px solid transparent;
        }
        .pk-card.selected { border-color: var(--primary); background: #F0F5F7; }
        .pk-img { width: 65px; height: 65px; border-radius: 10px; object-fit: cover; background: #eee; }
        
        .final-actions { text-align: center; margin-top: auto; padding-bottom: max(30px, env(safe-area-inset-bottom)); }
        .btn-main {
            background: var(--primary); color: white; border: none; padding: 16px 40px;
            border-radius: 30px; font-size: 18px; font-weight: bold; width: 100%;
            box-shadow: 0 5px 15px rgba(122, 156, 165, 0.3); text-decoration: none; display: inline-flex; justify-content: center; align-items: center;
        }

        .final-img-big { width: 200px; height: 200px; border-radius: 50%; object-fit: cover; margin: 0 auto 30px; box-shadow: var(--shadow); border: 6px solid white; display: block; }

        /* Toast */
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: white; padding: 15px 25px; border-radius: 30px;
            z-index: 500; opacity: 0; pointer-events: none; transition: opacity 0.3s;
            text-align: center; width: 80%; max-width: 300px;
        }

        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="toast" class="toast"></div>

    <div id="onboarding" class="onboarding-layer">
        <div class="q-step active" id="step1">
            <div class="q-title">ä»Šå¤©é ç®—å¦‚ä½•ï¼Ÿ</div>
            <div class="option-grid">
                <div class="option-btn" onclick="nextStep(1, 'price', 1)">ğŸ’° ä¾¿å®œç°¡å–®åƒ</div>
                <div class="option-btn" onclick="nextStep(1, 'price', 2)">ğŸ’µ ä¸€èˆ¬èšé¤åƒ¹ä½</div>
                <div class="option-btn" onclick="nextStep(1, 'price', 3)">ğŸ’ è±ªè¯å¤§é¤</div>
                <div class="option-btn" onclick="nextStep(1, 'price', 0)">ğŸ¤· æ²’å·®ï¼Œçœ‹æ„Ÿè¦º</div>
            </div>
        </div>
        <div class="q-step" id="step2">
            <div class="q-title">ç¾åœ¨é¤“å—ï¼Ÿ</div>
            <div class="option-grid">
                <div class="option-btn" onclick="nextStep(2, 'heavy', false)">ğŸ¥— ä¸å¤ªé¤“ï¼Œè¼•é£Ÿå°±å¥½</div>
                <div class="option-btn" onclick="nextStep(2, 'heavy', true)">ğŸ– è¶…é¤“ï¼Œæˆ‘è¦åƒé£½</div>
                <div class="option-btn" onclick="nextStep(2, 'heavy', null)">ğŸ¤· éƒ½å¯ä»¥</div>
            </div>
        </div>
        <div class="q-step" id="step3">
            <div class="q-title">ä»Šå¤©å¿ƒæƒ…/å¤©æ°£ï¼Ÿ</div>
            <div class="option-grid">
                <div class="option-btn" onclick="startGame('soup')">ğŸ¥£ æƒ³å–ç†±æ¹¯</div>
                <div class="option-btn" onclick="startGame('dry')">ğŸ¥¢ æƒ³åƒä¹¾çš„</div>
                <div class="option-btn" onclick="startGame('spicy')">ğŸŒ¶ï¸ æƒ³åƒè¾£ï¼</div>
                <div class="option-btn" onclick="startGame('all')">ğŸŒˆ æ²’æƒ³æ³•ï¼Œçµ¦æˆ‘é©šå–œ</div>
            </div>
        </div>
    </div>

    <div class="header">
        <div class="app-logo">WHAT TO EAT</div>
        <div id="wishCounter" class="wishlist-counter">â¤ï¸ 0 / 3</div>
    </div>

    <div class="main-stage">
        <div id="browseMode" class="browse-mode">
            <div id="cardContainer" class="food-card">
                <div class="food-img-box">
                    <img id="fImg" class="food-img" src="" onerror="this.src='https://via.placeholder.com/400x300/e0e0e0/888888?text=Yummy';">
                    <span id="fPrice" class="price-badge">$$</span>
                </div>
                <div class="food-content">
                    <div id="fName" class="food-title">è¼‰å…¥ä¸­...</div>
                    <div class="tag-row" id="fTags"></div>
                    <div id="fDesc" class="food-desc"></div>
                    
                    <div class="filter-section">
                        <div class="filter-title">ä¸æƒ³åƒé€™å€‹ï¼Ÿéæ¿¾ï¼š</div>
                        <div class="quick-actions">
                            <div class="chip-btn" onclick="filterOut('cat')">ğŸš« é€™é¡å…ˆä¸è¦</div>
                            <div class="chip-btn" onclick="filterOut('heavy')">ğŸ¥¦ å¤ªæ²¹è†©</div>
                            <div class="chip-btn" onclick="filterOut('spicy')">ğŸŒ¶ï¸ ä¸åƒè¾£</div>
                            <div class="chip-btn" onclick="filterOut('expensive')">ğŸ’¸ å¤ªè²´</div>
                            <div class="chip-btn" onclick="filterOut('smell')">ğŸ¤¢ å‘³é“å¤ªé‡</div>
                            <div class="chip-btn" onclick="filterOut('big')">ğŸ¦• ä»½é‡å¤ªå¤š</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-controls">
        <button class="big-btn btn-pass" onclick="nextCard()">
            <i class="fas fa-times"></i>
        </button>
        <button class="big-btn btn-keep" onclick="addToWishlist()">
            <i class="fas fa-heart"></i>
        </button>
    </div>

    <div id="shortlistMode" class="full-screen-mode">
        <h2 style="text-align:center; color:var(--primary); margin-bottom:10px;">æ±ºé¸æ“‚å° ğŸ‘‘</h2>
        <p style="text-align:center; color:#999; font-size:14px; margin-bottom:30px;">é€™ 3 å®¶ä½ éƒ½æƒ³åƒï¼Œé¸ä¸€å®¶æœ€æƒ³å»çš„ï¼</p>
        <div id="pkList" class="pk-container"></div>
        <div class="final-actions">
            <button class="btn-main" style="background:white; color:var(--secondary); border:2px solid var(--secondary);" onclick="randomPickFinal()">
                ğŸ² å¹«æˆ‘é¸ï¼
            </button>
        </div>
    </div>

    <div id="successOverlay" class="full-screen-mode" style="justify-content:center; text-align:center;">
        <img id="finalImg" class="final-img-big" onerror="this.src='https://via.placeholder.com/400x300/e0e0e0/888888?text=Enjoy';">
        <h2 style="color:var(--primary); margin-bottom:10px;">ä»Šæ™šå°±åƒé€™å€‹ï¼</h2>
        <h1 id="finalName" style="font-size:32px; margin:0 0 30px 0; color:var(--text);"></h1>
        
        <a id="mapLink" href="#" target="_blank" class="btn-main">
            <i class="fas fa-location-arrow" style="margin-right:10px;"></i> Google Maps å°èˆª
        </a>
        <div style="margin-top:40px; color:#999; text-decoration:underline; cursor:pointer;" onclick="location.reload()">é‡ç©ä¸€æ¬¡</div>
    </div>

    <script>
        // === è³‡æ–™åº« (50+ å®Œæ•´ç‰ˆ) ===
        const database = [
            { name: "æ»·è‚‰é£¯", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1627207644063-267926715201?w=600", desc: "åœ‹æ°‘ç¾é£Ÿï¼Œè‚¥ç˜¦æ»·æ±æ·‹åœ¨ç™½é£¯ä¸Šï¼Œç°¡å–®å»éŠ·é­‚ã€‚" },
            { name: "ç´…ç‡’ç‰›è‚‰éºµ", cat: "å°å¼", price: 2, heavy: true, soup: true, spicy: true, smell: false, big: false, img: "https://images.unsplash.com/photo-1596458397260-255551c09534?w=600", desc: "æ¿ƒéƒæ¹¯é ­é…ä¸Šå¤§å¡Šç‰›è‚‰ï¼Œå°ç£ä¹‹å…‰ã€‚" },
            { name: "å¤§é›æ’", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, smell: true, big: true, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600", desc: "ç‚¸å¾—é‡‘é»ƒé…¥è„†ï¼Œç½ªæƒ¡æ„Ÿèˆ‡å¹¸ç¦æ„ŸåŒæ™‚çˆ†è¡¨ã€‚" },
            { name: "è„†çš®è‡­è±†è…", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1583069358212-04e8d89ce58a?w=600", desc: "å¤–é…¥å…§å«©ï¼Œå¡å…¥æ³¡èœä¸€å£å’¬ä¸‹ï¼Œçµ•é…ã€‚" },
            { name: "éº»è¾£é´¨è¡€", cat: "å°å¼", price: 1, heavy: true, soup: true, spicy: true, smell: true, big: false, img: "https://images.unsplash.com/photo-1541280910158-c4e34faf2c00?w=600", desc: "æ»‘å«©é´¨è¡€å¸æ»¿è¾£æ¹¯ï¼Œå…¥å‘³åˆé–‹èƒƒã€‚" },
            { name: "è—¥ç‡‰æ’éª¨", cat: "å°å¼", price: 2, heavy: false, soup: true, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1609770502127-6c236e76556d?w=600", desc: "ä¸­è—¥é¦™æ°£å››æº¢ï¼Œå†¬å¤©æº«è£œé¦–é¸ã€‚" },
            { name: "æ¸…ç²¥å°èœ", cat: "å°å¼", price: 2, heavy: false, soup: true, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1516684732738-16fa2021c179?w=600", desc: "æ¸…æ·¡ç™½ç²¥é…ä¸Šå¤šæ¨£å°èœï¼Œæš–èƒƒåˆè±å¯Œã€‚" },
            { name: "å°å¼ç†±ç‚’", cat: "å°å¼", price: 2, heavy: true, soup: false, spicy: true, smell: true, big: true, img: "https://images.unsplash.com/photo-1551249721-a4b51cc13075?w=600", desc: "å®®ä¿é›ä¸ã€é³³æ¢¨è¦çƒï¼Œé…å•¤é…’æœ€å°å‘³ã€‚" },
            { name: "èšµä»”ç…", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?w=600", desc: "ç²‰æ¼¿Qå½ˆï¼Œé®®èšµé£½æ»¿ï¼Œæ·‹ä¸Šç”œè¾£é†¬ã€‚" },
            { name: "æ½¤é¤…æ²", cat: "å°å¼", price: 1, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1609180746973-20739c381c8b?w=600", desc: "æ»¿æ»¿è”¬èœèˆ‡èŠ±ç”Ÿç²‰ï¼Œæ¸…çˆ½åˆæœ‰é£½è¶³æ„Ÿã€‚" },
            { name: "ä¹¾éºµ+æ»·å‘³", cat: "å°å¼", price: 1, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1552611052-33e04de081de?w=600", desc: "ç°¡å–®çš„éºµé£Ÿé…ä¸Šè±†ä¹¾æµ·å¸¶ï¼Œæ—¥å¸¸ç¾å‘³ã€‚" },
            { name: "ç«é›è‚‰é£¯", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1606525437679-037aca74a3e9?w=600", desc: "é®®å«©ç«é›è‚‰çµ²æ·‹ä¸Šé›æ²¹ï¼Œé¦™æ°£å››æº¢ã€‚" },
            { name: "å¤§è…¸åŒ…å°è…¸", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1574484284002-952d92456975?w=600", desc: "ç³¯ç±³è…¸åŒ…é¦™è…¸ï¼Œé…ä¸Šè’œé ­æœ€å°å‘³ã€‚" },
            { name: "æ—¥å¼æ‹‰éºµ", cat: "æ—¥å¼", price: 2, heavy: true, soup: true, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=600", desc: "æ¿ƒéƒè±šéª¨æ¹¯é ­ï¼Œé…ä¸Šå‹é“éºµæ¢ã€‚" },
            { name: "è¿´è½‰å£½å¸", cat: "æ—¥å¼", price: 2, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600", desc: "æ¸…çˆ½ç„¡è² æ“”ï¼Œæƒ³åƒå¤šå°‘æ‹¿å¤šå°‘ã€‚" },
            { name: "ç‚¸è±¬æ’å®šé£Ÿ", cat: "æ—¥å¼", price: 2, heavy: true, soup: false, spicy: false, smell: false, big: true, img: "https://images.unsplash.com/photo-1616428467478-43d969248232?w=600", desc: "å¤–é…¥å…§å«©çš„åšåˆ‡è±¬æ’ï¼Œé«˜éº—èœçµ²è§£è†©ã€‚" },
            { name: "ç‰›ä¸¼", cat: "æ—¥å¼", price: 1, heavy: true, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1554502078-ef0fc409efce?w=600", desc: "å¤§ç¢—è‚‰ç‰‡é‹ªåœ¨é£¯ä¸Šï¼Œå¿«é€Ÿæ»¿è¶³ã€‚" },
            { name: "æ—¥å¼å’–å“©", cat: "æ—¥å¼", price: 2, heavy: true, soup: true, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1604152135912-04a022e23696?w=600", desc: "æ¿ƒéƒç”˜ç”œçš„æ—¥å¼å’–å“©ï¼Œå¤§äººå°å­©éƒ½æ„›ã€‚" },
            { name: "æ—¥å¼ç‡’è‚‰", cat: "æ—¥å¼", price: 3, heavy: true, soup: false, spicy: false, smell: true, big: true, img: "https://images.unsplash.com/photo-1592685829283-7c0bb77df3c9?w=600", desc: "è‡ªå·±çƒ¤è‚‰çš„æ¨‚è¶£ï¼Œè‚‰é£Ÿè€…å¤©å ‚ã€‚" },
            { name: "å±…é…’å±‹ä¸²ç‡’", cat: "æ—¥å¼", price: 3, heavy: true, soup: false, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1534604973900-c43ab4c2e0ab?w=600", desc: "ç‚­ç«é¦™æ°£è¿·äººï¼Œä¸‹ç­å°é…Œé¦–é¸ã€‚" },
            { name: "ç”Ÿé­šç‰‡ä¸¼", cat: "æ—¥å¼", price: 3, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1562436260-8c9216eeb703?w=600", desc: "è±ªè¯æµ·é®®é‹ªæ»¿é†‹é£¯ï¼Œé®®å‘³åè¶³ã€‚" },
            { name: "å¤©å©¦ç¾…ä¸¼", cat: "æ—¥å¼", price: 2, heavy: true, soup: false, spicy: false, smell: false, big: true, img: "https://images.unsplash.com/photo-1560155016-16e6c1cc3e53?w=600", desc: "è±ªé‚ç‚¸è¦èˆ‡è”¬èœï¼Œæ·‹ä¸Šé¹¹ç”œé†¬æ±ã€‚" },
            { name: "çƒé¾éºµ", cat: "æ—¥å¼", price: 1, heavy: false, soup: true, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=600", desc: "Qå½ˆæ»‘é †éºµæ¢ï¼Œé…ä¸Šæ¸…çˆ½é«˜æ¹¯ã€‚" },
            { name: "éº»è¾£ç«é‹", cat: "ç«é‹", price: 3, heavy: true, soup: true, spicy: true, smell: true, big: true, img: "https://images.unsplash.com/photo-1596458397260-255551c09534?w=600", desc: "é¦™è¾£éç™®ï¼Œé©åˆé‡å£å‘³èˆ‡å¤§é£Ÿé‡ã€‚" },
            { name: "å€‹äººå°ç«é‹", cat: "ç«é‹", price: 1, heavy: true, soup: true, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1547592166-23acbe34071b?w=600", desc: "ä¸€å€‹äººä¹Ÿèƒ½æš–æš–åƒé‹ï¼ŒCPå€¼é«˜ã€‚" },
            { name: "å£½å–œç‡’", cat: "æ—¥å¼", price: 2, heavy: true, soup: true, spicy: false, smell: false, big: true, img: "https://images.unsplash.com/photo-1584213123849-5f1118335914?w=600", desc: "é¹¹ç”œé†¬æ±æ¶®è‚‰ç‰‡ï¼Œæ²¾è›‹æ¶²è¶…æ»‘é †ã€‚" },
            { name: "è–‘æ¯é´¨", cat: "å°å¼", price: 2, heavy: true, soup: true, spicy: false, smell: true, big: true, img: "https://images.unsplash.com/photo-1616428467478-43d969248232?w=600", desc: "å†¬å¤©é€²è£œé¦–é¸ï¼Œç‚­ç«èˆ‡éº»æ²¹é¦™æ°£ã€‚" },
            { name: "ç¾å¼æ¼¢å ¡", cat: "ç¾å¼", price: 2, heavy: true, soup: false, spicy: false, smell: false, big: true, img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=600", desc: "åšå¯¦è‚‰æ’å¤šæ±ï¼Œå¤§å£å’¬ä¸‹è¶…æ»¿è¶³ã€‚" },
            { name: "éº¥ç•¶å‹", cat: "é€Ÿé£Ÿ", price: 1, heavy: true, soup: false, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=600", desc: "å¿«é€Ÿæ–¹ä¾¿ï¼Œè–¯æ¢æ˜¯éˆé­‚ã€‚" },
            { name: "è‚¯å¾·åŸº KFC", cat: "é€Ÿé£Ÿ", price: 1, heavy: true, soup: false, spicy: true, smell: true, big: false, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600", desc: "æƒ³åƒç‚¸é›å’Œè›‹å¡”çš„ä¸äºŒä¹‹é¸ã€‚" },
            { name: "æŠ«è–© Pizza", cat: "è¥¿å¼", price: 2, heavy: true, soup: false, spicy: false, smell: true, big: true, img: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=600", desc: "ç‰½çµ²èµ·å¸èˆ‡é…¥è„†é¤…çš®ï¼Œé©åˆåˆ†äº«ã€‚" },
            { name: "ç‰›æ’", cat: "è¥¿å¼", price: 3, heavy: true, soup: false, spicy: false, smell: false, big: true, img: "https://images.unsplash.com/photo-1600891964092-4316c288032e?w=600", desc: "æ…¶ç¥ç¯€æ—¥æˆ–çŠ’è³è‡ªå·±çš„å¥½é¸æ“‡ã€‚" },
            { name: "Subway", cat: "è¥¿å¼", price: 1, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1509722747741-092075b55909?w=600", desc: "æ»¿æ»¿è”¬èœæ½›è‰‡å ¡ï¼Œå¥åº·æ–¹ä¾¿ã€‚" },
            { name: "ç¾©å¤§åˆ©éºµ", cat: "è¥¿å¼", price: 2, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?w=600", desc: "å¥¶æ²¹ã€é’é†¬æˆ–ç•ªèŒ„ï¼Œå£å‘³å¤šè®Šã€‚" },
            { name: "æ—©åˆé¤ Brunch", cat: "è¥¿å¼", price: 2, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1533089862017-5614ecb3f2f2?w=600", desc: "ç­å°¼è¿ªå…‹è›‹é…å’–å•¡ï¼Œæ‚ é–’ä¸€é¤ã€‚" },
            { name: "å‡±è–©æ²™æ‹‰", cat: "è¥¿å¼", price: 2, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600", desc: "å¤§é‡ç”Ÿèœé…é›è‚‰ï¼Œè¼•ç›ˆç„¡è² æ“”ã€‚" },
            { name: "ç¾©å¼ç‡‰é£¯", cat: "è¥¿å¼", price: 2, heavy: true, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1476124369491-e7addf5db371?w=600", desc: "å¸æ»¿é«˜æ¹¯ç²¾è¯çš„ç±³ç²’ï¼Œæ¿ƒéƒé£½è¶³ã€‚" },
            { name: "éŸ“å¼ç‚¸é›", cat: "éŸ“å¼", price: 2, heavy: true, soup: false, spicy: true, smell: true, big: true, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600", desc: "ç”œè¾£é†¬æ±è£¹é…¥è„†ç‚¸é›ï¼Œå®æŒ‡å›å‘³ã€‚" },
            { name: "éŸ“å¼æ³¡èœé‹", cat: "éŸ“å¼", price: 2, heavy: false, soup: true, spicy: true, smell: true, big: false, img: "https://images.unsplash.com/photo-1596458397260-255551c09534?w=600", desc: "é…¸è¾£é–‹èƒƒï¼Œé…ä¸Šä¸€ç¢—ç™½é£¯å‰›å‰›å¥½ã€‚" },
            { name: "æ³°å¼æ–™ç†", cat: "æ³°å¼", price: 2, heavy: false, soup: true, spicy: true, smell: true, big: false, img: "https://images.unsplash.com/photo-1559314809-0d155014e29e?w=600", desc: "é…¸è¾£é–‹èƒƒï¼Œæœˆäº®è¦é¤…å¿…é»ã€‚" },
            { name: "è¶Šå—æ²³ç²‰", cat: "è¶Šå¼", price: 1, heavy: false, soup: true, spicy: false, smell: true, big: false, img: "https://images.unsplash.com/photo-1582878826629-29b7ad1cdc43?w=600", desc: "æ¸…ç”œæ¹¯é ­é…æ»‘é †æ²³ç²‰ï¼ŒåŠ é»æª¸æª¬ã€‚" },
            { name: "æ¸¯å¼é£²èŒ¶", cat: "æ¸¯å¼", price: 2, heavy: true, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1541696490865-e6f720e9c195?w=600", desc: "ç‡’è³£ã€è¦é¤ƒã€å‰ç‡’åŒ…ï¼Œæ¨£æ¨£ä¾†ä¸€é»ã€‚" },
            { name: "å°åº¦å’–å“©", cat: "ç•°åœ‹", price: 2, heavy: true, soup: true, spicy: true, smell: true, big: false, img: "https://images.unsplash.com/photo-1604152135912-04a022e23696?w=600", desc: "é¦™æ–™å‘³æ¿ƒéƒï¼Œé…çƒ¤é¤…ä¸€çµ•ã€‚" },
            { name: "å¥åº·é¤ç›’", cat: "å¥åº·", price: 2, heavy: false, soup: false, spicy: false, smell: false, big: false, img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600", desc: "æ°´ç…®ä½å¡ï¼Œå¢è‚Œæ¸›è„‚é¦–é¸ã€‚" }
        ];

        // === é‚è¼¯å€ ===
        let userPref = { price: 0, heavy: null }; 
        let pool = [];
        let currentItem = null;
        let wishlist = [];
        const MAX_WISH = 3;

        // 1. å•å·é‚è¼¯
        function nextStep(current, key, value) {
            userPref[key] = value;
            document.getElementById(`step${current}`).classList.remove('active');
            document.getElementById(`step${current+1}`).classList.add('active');
        }

        // 2. é–‹å§‹ç¯©é¸ (æ™ºæ…§æ”¾å¯¬)
        function startGame(type) {
            document.getElementById('onboarding').classList.add('hidden');
            
            // åˆæ­¥ç¯©é¸
            pool = database.filter(item => {
                if (userPref.price !== 0 && item.price !== userPref.price) return false;
                if (userPref.heavy !== null && item.heavy !== userPref.heavy) return false;
                if (type === 'soup' && !item.soup) return false;
                if (type === 'dry' && item.soup) return false;
                if (type === 'spicy' && !item.spicy) return false;
                return true;
            });

            // æ™ºæ…§æ”¾å¯¬æ©Ÿåˆ¶
            if (pool.length < 5) {
                showToast("ç¬¦åˆæ¢ä»¶å¤ªå°‘ï¼Œå·²è‡ªå‹•æ”¾å¯¬é ç®—èˆ‡å£å‘³é™åˆ¶ ğŸ‘Œ");
                // é‡æ–°ç¯©é¸ï¼šåªä¿ç•™æœ€é—œéµçš„ type (å¿ƒæƒ…)ï¼Œæ”¾å¯¬é ç®—å’Œé£½è¶³æ„Ÿ
                pool = database.filter(item => {
                    if (type === 'soup' && !item.soup) return false;
                    if (type === 'dry' && item.soup) return false;
                    if (type === 'spicy' && !item.spicy) return false;
                    return true;
                });
            }

            renderCard();
        }

        // 3. æ¸²æŸ“å¡ç‰‡
        function renderCard() {
            if (pool.length === 0) {
                alert("é¸é …çœ‹å®Œäº†ï¼é‡æ–°æ´—ç‰Œ...");
                pool = [...database];
            }

            // éš¨æ©ŸæŠ½
            const idx = Math.floor(Math.random() * pool.length);
            currentItem = pool[idx];

            // å¡«å…¥è³‡æ–™
            document.getElementById('fImg').src = currentItem.img;
            document.getElementById('fName').innerText = currentItem.name;
            document.getElementById('fDesc').innerText = currentItem.desc;
            
            // æ¨™ç±¤
            let tagsHtml = `<span class="info-tag">${currentItem.cat}</span>`;
            if(currentItem.heavy) tagsHtml += `<span class="info-tag">é£½è¶³</span>`;
            else tagsHtml += `<span class="info-tag">è¼•é£Ÿ</span>`;
            if(currentItem.soup) tagsHtml += `<span class="info-tag">æœ‰æ¹¯</span>`;
            
            document.getElementById('fTags').innerHTML = tagsHtml;

            // åƒ¹æ ¼
            let pStr = "";
            for(let i=0; i<3; i++) pStr += i < currentItem.price ? "â˜…" : "â˜†";
            document.getElementById('fPrice').innerText = pStr;

            // å‹•ç•«
            const card = document.getElementById('cardContainer');
            card.style.animation = 'none';
            card.offsetHeight; 
            card.style.animation = 'popIn 0.3s';
        }

        // 4. æŒ‰éˆ•æ“ä½œ
        function nextCard() { 
            // é¿å…éš¨æ©ŸæŠ½åˆ°åŒä¸€å¼µ
            if (pool.length > 1) {
                let newItem = currentItem;
                while (newItem === currentItem) {
                    const idx = Math.floor(Math.random() * pool.length);
                    newItem = pool[idx];
                }
                currentItem = newItem;
                // æ‰‹å‹•å‘¼å« render éƒ¨åˆ†é‚è¼¯æ›´æ–°ç•«é¢ï¼Œé¿å…éè¿´
                document.getElementById('fImg').src = currentItem.img;
                document.getElementById('fName').innerText = currentItem.name;
                document.getElementById('fDesc').innerText = currentItem.desc;
                // ... (ç°¡åŒ–ï¼Œå¯¦éš›å»ºè­°ç›´æ¥ renderCard ä½†é–å®š currentItem é‚è¼¯)
                renderCard(); 
            } else {
                showToast("åªå‰©é€™å¼µäº†ï¼");
            }
        }

        function addToWishlist() {
            if (wishlist.some(i => i.name === currentItem.name)) {
                showToast("å·²ç¶“åœ¨æ¸…å–®è£¡å›‰ï¼");
                nextCard();
                return;
            }
            wishlist.push(currentItem);
            updateCounter();
            pool = pool.filter(i => i.name !== currentItem.name);

            if (wishlist.length >= MAX_WISH) {
                showShortlist();
            } else {
                nextCard();
            }
        }

        function updateCounter() {
            const counter = document.getElementById('wishCounter');
            counter.innerText = `â¤ï¸ ${wishlist.length} / ${MAX_WISH}`;
            counter.classList.add('bump');
            setTimeout(() => counter.classList.remove('bump'), 200);
        }

        // 5. éæ¿¾é‚è¼¯
        function filterOut(reason) {
            pool = pool.filter(i => i.name !== currentItem.name);

            let msg = "";
            if (reason === 'cat') { pool = pool.filter(i => i.cat !== currentItem.cat); msg="éæ¿¾åŒé¡åˆ¥"; }
            else if (reason === 'heavy') { pool = pool.filter(i => !i.heavy); msg="éæ¿¾æ²¹è†©"; }
            else if (reason === 'spicy') { pool = pool.filter(i => !i.spicy); msg="éæ¿¾è¾£å‘³"; }
            else if (reason === 'expensive') { pool = pool.filter(i => i.price < currentItem.price); msg="éæ¿¾é«˜åƒ¹"; }
            else if (reason === 'smell') { pool = pool.filter(i => !i.smell); msg="éæ¿¾é‡å£å‘³"; }
            else if (reason === 'big') { pool = pool.filter(i => !i.big); msg="éæ¿¾å¤§ä»½é‡"; }
            
            showToast(msg);
            
            // æª¢æŸ¥éæ¿¾å¾Œæ˜¯å¦ç©ºäº†
            if (pool.length === 0) {
                alert("éæ¿¾å¤ªåš´æ ¼æ²’æ±è¥¿åƒäº†ï¼è‡ªå‹•é‡ç½®...");
                pool = [...database];
            }
            renderCard();
        }

        // 6. æ±ºé¸èˆ‡åœ°åœ–å°èˆªä¿®æ­£
        function showShortlist() {
            document.getElementById('browseMode').style.display = 'none';
            document.getElementById('shortlistMode').classList.add('show');
            const container = document.getElementById('pkList');
            container.innerHTML = wishlist.map((item, idx) => `
                <div class="pk-card" onclick="finalDecide(${idx})">
                    <img src="${item.img}" class="pk-img" onerror="this.src='https://via.placeholder.com/60'">
                    <div class="pk-info">
                        <div class="pk-name">${item.name}</div>
                        <div class="pk-meta">${item.desc}</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color:#ddd;"></i>
                </div>
            `).join('');
        }

        function finalDecide(idx) { showSuccess(wishlist[idx]); }

        function randomPickFinal() {
            const idx = Math.floor(Math.random() * wishlist.length);
            let count = 0;
            const interval = setInterval(() => {
                const cards = document.querySelectorAll('.pk-card');
                cards.forEach(c => c.classList.remove('selected'));
                cards[count % cards.length].classList.add('selected');
                count++;
                if (count > 10) {
                    clearInterval(interval);
                    setTimeout(() => showSuccess(wishlist[idx]), 500);
                }
            }, 100);
        }

        function showSuccess(item) {
            document.getElementById('successOverlay').classList.add('show');
            document.getElementById('finalImg').src = item.img;
            document.getElementById('finalName').innerText = item.name;
            // ä¿®æ­£ï¼šä½¿ç”¨ Google Maps å®˜æ–¹æ¨™æº–æœå°‹é€£çµ
            const q = encodeURIComponent(item.name);
            document.getElementById('mapLink').href = `https://www.google.com/maps/search/?api=1&query=${q}`;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.opacity = 1;
            setTimeout(() => t.style.opacity = 0, 1500);
        }
    </script>
</body>
</html>