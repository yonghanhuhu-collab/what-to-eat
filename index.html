<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WHAT TO EAT</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F0F2F5;
            --card-bg: #FFFFFF;
            --text-main: #333333;
            --text-sub: #777777;
            --primary: #FF6B6B; /* æ„›å¿ƒç´… */
            --secondary: #4ECDC4; /* æ¸…çˆ½ç¶  */
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --radius: 20px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { 
            margin: 0; padding: 0; font-family: 'Noto Sans TC', sans-serif; 
            background: var(--bg); color: var(--text-main); height: 100dvh; 
            overflow: hidden; display: flex; flex-direction: column;
        }

        /* === Header === */
        .header {
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            font-weight: 900; letter-spacing: 1px; color: #5F7D8B;
            padding-top: max(15px, env(safe-area-inset-top));
        }
        .heart-counter {
            background: #fff; padding: 5px 12px; border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: var(--primary); font-weight: bold;
        }

        /* === View Container === */
        .view {
            flex: 1; display: none; flex-direction: column; 
            align-items: center; justify-content: center;
            padding: 20px; position: relative; width: 100%;
            animation: fadeIn 0.4s ease;
        }
        .view.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* === Wizard (Questions) === */
        .question-title { font-size: 22px; font-weight: 700; color: #5F7D8B; margin-bottom: 30px; text-align: center; }
        .option-btn {
            width: 100%; max-width: 340px; background: white; 
            padding: 18px; margin-bottom: 15px; border-radius: 12px;
            font-size: 16px; font-weight: 700; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); cursor: pointer;
            transition: transform 0.1s; border: 2px solid transparent;
        }
        .option-btn:active { transform: scale(0.98); background: #f9f9f9; }

        /* === Card Stack (Tinder Style) === */
        .card-container {
            width: 100%; max-width: 340px; aspect-ratio: 3/4.2;
            position: relative; perspective: 1000px;
        }
        .food-card {
            position: absolute; inset: 0; background: white; border-radius: var(--radius);
            box-shadow: var(--shadow); overflow: hidden;
            display: flex; flex-direction: column;
            transform-origin: 50% 100%; transition: transform 0.3s, opacity 0.3s;
        }
        
        /* åœ–ç‰‡å€åŸŸ */
        .card-img {
            height: 55%; width: 100%; background: #eee;
            background-size: cover; background-position: center;
        }
        
        /* å…§å®¹å€åŸŸ */
        .card-content { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 24px; font-weight: 900; margin-bottom: 10px; }
        .tags { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
        .tag { 
            font-size: 12px; background: #F0F2F5; color: #5F7D8B; 
            padding: 4px 10px; border-radius: 10px; font-weight: 500; 
        }
        .desc { font-size: 14px; color: var(--text-sub); line-height: 1.5; flex: 1; }
        
        /* éæ¿¾å°æŒ‰éˆ• */
        .filter-tags { 
            display: flex; gap: 10px; margin-top: 15px; overflow-x: auto; padding-bottom: 5px;
        }
        .filter-chip {
            border: 1px solid #eee; padding: 6px 12px; border-radius: 20px;
            font-size: 12px; color: #888; display: flex; align-items: center; gap: 5px;
            cursor: pointer; white-space: nowrap;
        }
        .filter-chip:active { background: #fee; color: var(--primary); border-color: var(--primary); }

        /* åº•éƒ¨å¤§æŒ‰éˆ• */
        .action-bar {
            display: flex; gap: 20px; margin-top: 25px;
            width: 100%; max-width: 340px; justify-content: center;
        }
        .big-btn {
            width: 60px; height: 60px; border-radius: 50%;
            background: white; border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-size: 24px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.1s;
        }
        .btn-pass { color: #ccc; }
        .btn-like { color: var(--primary); background: #FFF0F0; }
        .big-btn:active { transform: scale(1.1); }

        /* === Podium (æ±ºé¸æ¸…å–®) === */
        .podium-list { width: 100%; max-width: 360px; }
        .podium-item {
            background: white; padding: 15px; border-radius: 12px; margin-bottom: 12px;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer;
        }
        .p-img { width: 60px; height: 60px; border-radius: 8px; background: #eee; background-size: cover; background-position: center; }
        .p-info { flex: 1; }
        .p-name { font-weight: bold; font-size: 16px; margin-bottom: 4px; }
        .p-desc { font-size: 12px; color: #999; }
        
        .dice-btn {
            margin-top: 20px; width: 100%; max-width: 360px;
            background: white; border: 1px solid #ddd; padding: 15px;
            border-radius: 30px; font-weight: bold; color: #5F7D8B;
        }

        /* === Result View === */
        .result-img-circle {
            width: 200px; height: 200px; border-radius: 50%; 
            background: #eee; margin-bottom: 20px; border: 5px solid white;
            box-shadow: var(--shadow); background-size: cover; background-position: center;
        }
        .map-btn {
            background: #607D8B; color: white; width: 100%; max-width: 340px;
            padding: 15px; border-radius: 30px; text-decoration: none;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            font-weight: bold; box-shadow: 0 5px 15px rgba(96, 125, 139, 0.3);
            margin-top: 20px;
        }

        /* ç‹€æ…‹æç¤º */
        .empty-msg { text-align: center; color: #999; margin-top: 50px; line-height: 1.6; }
    </style>
</head>
<body>

    <div class="header">
        <div>WHAT TO EAT</div>
        <div class="heart-counter" id="counter" style="display:none;">â¤ï¸ 0 / 3</div>
    </div>

    <div id="v-hunger" class="view active">
        <div class="question-title">ç¾åœ¨é¤“å—ï¼Ÿ</div>
        <div class="option-btn" onclick="nextStep('hunger', 'light')">ğŸ¥— ä¸å¤ªé¤“ï¼Œè¼•é£Ÿå°±å¥½</div>
        <div class="option-btn" onclick="nextStep('hunger', 'full')">ğŸ– è¶…é¤“ï¼Œæˆ‘è¦åƒé£½</div>
        <div class="option-btn" onclick="nextStep('hunger', 'any')">ğŸ¤· éƒ½çµ¦</div>
    </div>

    <div id="v-mood" class="view">
        <div class="question-title">ä»Šå¤©å¿ƒæƒ…/å¤©æ°£ï¼Ÿ</div>
        <div class="option-btn" onclick="nextStep('mood', 'soup')">ğŸ¥£ æƒ³å–ç†±æ¹¯</div>
        <div class="option-btn" onclick="nextStep('mood', 'dry')">ğŸ¥¢ æƒ³åƒä¹¾çš„</div>
        <div class="option-btn" onclick="nextStep('mood', 'spicy')">ğŸŒ¶ï¸ æƒ³åƒè¾£ï¼</div>
        <div class="option-btn" onclick="nextStep('mood', 'any')">ğŸŒˆ æ²’æƒ³æ³•ï¼Œçµ¦æˆ‘é©šå–œ</div>
    </div>

    <div id="v-budget" class="view">
        <div class="question-title">ä»Šå¤©é ç®—å¦‚ä½•ï¼Ÿ</div>
        <div class="option-btn" onclick="nextStep('budget', 1)">ğŸ’° ä¾¿å®œç°¡å–®åƒ ($)</div>
        <div class="option-btn" onclick="nextStep('budget', 2)">ğŸ’µ ä¸€èˆ¬èšé¤åƒ¹ä½ ($$)</div>
        <div class="option-btn" onclick="nextStep('budget', 3)">ğŸ’ è±ªè¯å¤§é¤ ($$$)</div>
        <div class="option-btn" onclick="nextStep('budget', 0)">ğŸ’¸ æ²’å·®ï¼Œçœ‹æ„Ÿè¦º</div>
    </div>

    <div id="v-swipe" class="view">
        <div class="card-container" id="cardStack">
            </div>
        
        <div class="action-bar">
            <button class="big-btn btn-pass" onclick="handleSwipe(false)"><i class="fas fa-times"></i></button>
            <button class="big-btn btn-like" onclick="handleSwipe(true)"><i class="fas fa-heart"></i></button>
        </div>
    </div>

    <div id="v-podium" class="view">
        <div class="question-title">æ±ºé¸æ“‚å° ğŸ‘‘</div>
        <div style="text-align:center; color:#999; margin-bottom:20px; font-size:14px;">é€™ 3 å®¶ä½ éƒ½æƒ³åƒï¼Œé¸ä¸€å®¶æœ€æƒ³å»çš„ï¼</div>
        <div class="podium-list" id="podiumList"></div>
        <button class="dice-btn" onclick="randomPick()"><i class="fas fa-dice"></i> å¹«æˆ‘é¸ï¼</button>
    </div>

    <div id="v-result" class="view">
        <div class="result-img-circle" id="resImg"></div>
        <div style="font-size:14px; color:#999; margin-bottom:5px;">ä»Šæ™šå°±åƒé€™å€‹ï¼</div>
        <h1 style="font-size:32px; margin:0; margin-bottom:20px;" id="resName">æ—¥å¼ç‡’è‚‰</h1>
        <div class="tags" id="resTags" style="justify-content:center;"></div>
        
        <a id="resLink" href="#" target="_blank" class="map-btn">
            <i class="fas fa-location-arrow"></i> æœå°‹é™„è¿‘åº—å®¶
        </a>
        <div style="margin-top:20px; text-decoration:underline; color:#999; cursor:pointer;" onclick="location.reload()">é‡ç©ä¸€æ¬¡</div>
    </div>

    <script>
        // === 100é“ç¾é£Ÿè³‡æ–™åº« (å«è©³ç´°æ¨™ç±¤) ===
        // åƒ¹æ ¼: 1=ä¾¿å®œ, 2=ä¸€èˆ¬, 3=è²´
        // tags: ç”¨æ–¼é¡¯ç¤º
        // type: soup, dry, light, spicy, greasy (ç”¨æ–¼éæ¿¾)
        const db = [
            // æ—¥å¼
            { n: "è±šéª¨æ‹‰éºµ", t: ["æ—¥å¼", "æœ‰æ¹¯"], p: 2, f: ["soup", "greasy", "full"], d: "æ¿ƒéƒæ¹¯é ­ï¼Œæš–èƒƒé¦–é¸", i: "ramen" },
            { n: "æ—¥å¼æ²¾éºµ", t: ["æ—¥å¼", "Qå½ˆ"], p: 2, f: ["dry", "full"], d: "æ¿ƒåšé†¬æ±å¸é™„éºµæ¢", i: "tsukemen" },
            { n: "æ—¥å¼ç‰›ä¸¼", t: ["æ—¥å¼", "å¿«é€Ÿ"], p: 1, f: ["dry", "full"], d: "ç”œé¹¹é†¬æ±æ‹Œé£¯", i: "gyudon" },
            { n: "ç‚¸è±¬æ’å®šé£Ÿ", t: ["æ—¥å¼", "é£½è¶³"], p: 2, f: ["dry", "greasy", "full"], d: "å¤–é…¥å…§å«©åšåˆ‡è±¬æ’", i: "tonkatsu" },
            { n: "è¦ªå­ä¸¼", t: ["æ—¥å¼", "æ»‘å«©"], p: 1, f: ["dry", "full"], d: "é›è‚‰èˆ‡è›‹çš„å®Œç¾çµåˆ", i: "oyakodon" },
            { n: "è¿´è½‰å£½å¸", t: ["æ—¥å¼", "æ¸…çˆ½"], p: 2, f: ["dry", "light"], d: "å¤šæ¨£åŒ–é¸æ“‡ï¼Œæƒ³åƒå¤šå°‘æ‹¿å¤šå°‘", i: "sushi" },
            { n: "æ—¥å¼å’–å“©é£¯", t: ["æ—¥å¼", "æ¿ƒéƒ"], p: 2, f: ["dry", "full"], d: "ç”˜ç”œæ¿ƒéƒçš„æ—¥å¼é¢¨å‘³", i: "curry" },
            { n: "å¤©å©¦ç¾…ä¸¼", t: ["æ—¥å¼", "é…¥è„†"], p: 2, f: ["dry", "greasy", "full"], d: "æ»¿æ»¿ç‚¸è¦èˆ‡è”¬èœ", i: "tempura" },
            { n: "æ—¥å¼ç‡’è‚‰", t: ["æ—¥å¼", "èšé¤"], p: 3, f: ["dry", "greasy", "full"], d: "è‡ªå·±çƒ¤è‚‰çš„æ¨‚è¶£ï¼Œè‚‰é£Ÿè€…å¤©å ‚", i: "yakiniku" },
            { n: "å£½å–œç‡’", t: ["æ—¥å¼", "é‹ç‰©"], p: 3, f: ["soup", "full"], d: "ç”œé¹¹é†¬æ±æ¶®ç‰›è‚‰", i: "sukiyaki" },
            { n: "è®šå²çƒé¾éºµ", t: ["æ—¥å¼", "Qå½ˆ"], p: 1, f: ["soup", "light"], d: "ç°¡å–®æ¸…çˆ½çš„æŸ´é­šæ¹¯é ­", i: "udon" },
            { n: "å¤§é˜ªç‡’", t: ["æ—¥å¼", "éµæ¿"], p: 2, f: ["dry", "greasy", "full"], d: "æ»¿æ»¿çš„é«˜éº—èœèˆ‡é†¬æ±", i: "okonomiyaki" },
            { n: "è•éº¥éºµ", t: ["æ—¥å¼", "æ¶¼çˆ½"], p: 1, f: ["dry", "light"], d: "å¤æ—¥æ¶ˆæš‘é¦–é¸", i: "soba" },
            { n: "ç« é­šç‡’", t: ["æ—¥å¼", "å°åƒ"], p: 1, f: ["dry", "light"], d: "å¤–é…¥å…§è»Ÿçš„å°é»å¿ƒ", i: "takoyaki" },
            { n: "é°»é­šé£¯", t: ["æ—¥å¼", "é«˜ç´š"], p: 3, f: ["dry", "full"], d: "ç‚­çƒ¤é¦™æ°£ï¼Œè£œå…ƒæ°£", i: "unagi" },

            // ä¸­å¼/å°å¼
            { n: "ç´…ç‡’ç‰›è‚‰éºµ", t: ["å°å¼", "ç¶“å…¸"], p: 2, f: ["soup", "spicy", "full"], d: "å°ç£äººæœ€æ„›çš„ç¶“å…¸æ¹¯éºµ", i: "beef_noodle" },
            { n: "æ»·è‚‰é£¯+ç‡™é’èœ", t: ["å°å¼", "å¿…åƒ"], p: 1, f: ["dry", "greasy", "full"], d: "åœ‹æ°‘ç¾é£Ÿï¼Œè‚¥ç˜¦é©ä¸­", i: "braised_pork_rice" },
            { n: "å°ç± åŒ…", t: ["ä¸­å¼", "çˆ†æ¼¿"], p: 2, f: ["dry", "light"], d: "çš®è–„é¤¡å¤šæ¹¯æ±é®®ç¾", i: "xiaolongbao" },
            { n: "é‹è²¼/æ°´é¤ƒ", t: ["å°å¼", "æ–¹ä¾¿"], p: 1, f: ["dry", "greasy", "full"], d: "é…¥è„†å¤–çš®èˆ‡å¤šæ±å…§é¤¡", i: "dumplings" },
            { n: "éº»è¾£ç«é‹", t: ["ä¸­å¼", "èšé¤"], p: 3, f: ["soup", "spicy", "greasy", "full"], d: "é¦™è¾£éç™®ï¼Œé©åˆå¤šäºº", i: "hotpot" },
            { n: "é…¸è¾£æ¹¯é¤ƒ", t: ["å°å¼", "é–‹èƒƒ"], p: 1, f: ["soup", "spicy", "full"], d: "é…¸è¾£å¤ å‘³ï¼Œé£½è¶³æ„Ÿå¤ ", i: "sour_soup" },
            { n: "ç«é›è‚‰é£¯", t: ["å°å¼", "å˜‰ç¾©"], p: 1, f: ["dry", "greasy", "full"], d: "é›æ²¹é¦™æ°£åè¶³", i: "chicken_rice" },
            { n: "å°å¼ç†±ç‚’", t: ["å°å¼", "èšé¤"], p: 2, f: ["dry", "greasy", "full"], d: "å¤§ç«å¿«ç‚’ï¼Œé…å•¤é…’", i: "stir_fry" },
            { n: "æ’éª¨é£¯", t: ["å°å¼", "ä¾¿ç•¶"], p: 1, f: ["dry", "greasy", "full"], d: "å¤æ—©å‘³ç‚¸æ’éª¨", i: "pork_chop_rice" },
            { n: "æ¸…ç²¥å°èœ", t: ["å°å¼", "æ¸…æ·¡"], p: 2, f: ["soup", "light"], d: "æš–èƒƒåˆæ¸…çˆ½", i: "congee" },
            { n: "èšµä»”ç…", t: ["å°å¼", "å°åƒ"], p: 1, f: ["dry", "greasy", "light"], d: "å¤œå¸‚å¿…åƒç¾é£Ÿ", i: "oyster_omelet" },
            { n: "å¤§è…¸è‡­è‡­é‹", t: ["å°å¼", "å°ç«é‹"], p: 1, f: ["soup", "spicy", "full"], d: "å¹³åƒ¹äº«å—ï¼Œæ–™å¤šå¯¦åœ¨", i: "stinky_tofu_pot" },
            { n: "è–‘æ¯é´¨/ç¾Šè‚‰çˆ", t: ["å°å¼", "é€²è£œ"], p: 3, f: ["soup", "full"], d: "å†¬å¤©é€²è£œé¦–é¸", i: "ginger_duck" },
            { n: "æ“”ä»”éºµ", t: ["å°å¼", "å‚³çµ±"], p: 1, f: ["soup", "light"], d: "è‚‰ç‡¥é¦™æ°£æ’²é¼»", i: "danzai_noodle" },
            { n: "æ½¤é¤…", t: ["å°å¼", "æ¸…çˆ½"], p: 1, f: ["dry", "light"], d: "æ»¿æ»¿è”¬èœå¥åº·é¸æ“‡", i: "popiah" },

            // ç¾å¼/è¥¿å¼
            { n: "ç¾å¼æ¼¢å ¡", t: ["ç¾å¼", "å¤§å£åƒ"], p: 2, f: ["dry", "greasy", "full"], d: "å¤šæ±ç‰›è‚‰æ’é…èµ·å¸", i: "burger" },
            { n: "ç¾©å¤§åˆ©éºµ", t: ["ç¾©å¼", "å¤šæ¨£"], p: 2, f: ["dry", "full"], d: "ç´…é†¬ç™½é†¬é’é†¬ä»»é¸", i: "pasta" },
            { n: "çª¯çƒ¤æŠ«è–©", t: ["ç¾©å¼", "åˆ†äº«"], p: 2, f: ["dry", "greasy", "full"], d: "è–„è„†é¤…çš®ï¼Œç‰½çµ²èµ·å¸", i: "pizza" },
            { n: "ç‰›æ’", t: ["è¥¿å¼", "æ…¶ç¥"], p: 3, f: ["dry", "greasy", "full"], d: "å¤§å£åƒè‚‰çš„æ»¿è¶³æ„Ÿ", i: "steak" },
            { n: "Subwayæ½›è‰‡å ¡", t: ["ç¾å¼", "å¥åº·"], p: 1, f: ["dry", "light"], d: "è”¬èœæ»¿æ»¿ï¼Œæ¸…çˆ½ç„¡è² æ“”", i: "subway" },
            { n: "æ—©åˆé¤Brunch", t: ["è¥¿å¼", "æ‚ é–’"], p: 2, f: ["dry", "light"], d: "ç­å°¼è¿ªå…‹è›‹èˆ‡æ³•å¼åå¸", i: "brunch" },
            { n: "ç‚¸é›(KFC/èƒ–è€çˆ¹)", t: ["ç¾å¼", "ç½ªæƒ¡"], p: 2, f: ["dry", "greasy", "full"], d: "é…¥è„†å¤–çš®å¤šæ±é›è‚‰", i: "fried_chicken" },
            { n: "ç‡‰é£¯", t: ["ç¾©å¼", "æ¿ƒéƒ"], p: 2, f: ["dry", "full"], d: "ç±³å¿ƒå¾®ç¡¬å£æ„Ÿ", i: "risotto" },
            { n: "å¢¨è¥¿å“¥æ²é¤…", t: ["ç•°åœ‹", "å¾®è¾£"], p: 1, f: ["dry", "spicy", "light"], d: "èèé†¬é…é…ªæ¢¨", i: "taco" },
            { n: "å‡±è–©æ²™æ‹‰", t: ["è¥¿å¼", "æ¸›è„‚"], p: 2, f: ["dry", "light"], d: "è¼•é£Ÿä¸»ç¾©é¦–é¸", i: "salad" },

            // éŸ“å¼/æ³°å¼/å…¶ä»–
            { n: "éŸ“å¼ç‚¸é›", t: ["éŸ“å¼", "ç”œè¾£"], p: 2, f: ["dry", "spicy", "greasy", "full"], d: "è£¹é†¬ç‚¸é›é…å•¤é…’", i: "korean_chicken" },
            { n: "çŸ³é‹æ‹Œé£¯", t: ["éŸ“å¼", "é‹å·´"], p: 2, f: ["dry", "spicy", "full"], d: "è±å¯Œé…èœæ‹Œè¾£é†¬", i: "bibimbap" },
            { n: "æ³¡èœé‹", t: ["éŸ“å¼", "é…¸è¾£"], p: 2, f: ["soup", "spicy", "full"], d: "é…¸è¾£é–‹èƒƒç†±æ¹¯", i: "kimchi_stew" },
            { n: "éŠ…ç›¤çƒ¤è‚‰", t: ["éŸ“å¼", "èšé¤"], p: 2, f: ["dry", "full"], d: "é‚Šçƒ¤è‚‰é‚Šå–æ¹¯", i: "korean_bbq" },
            { n: "æ³°å¼æ‰“æ‹‹è±¬", t: ["æ³°å¼", "ä¸‹é£¯"], p: 1, f: ["dry", "spicy", "greasy", "full"], d: "é…¸è¾£é¹¹é¦™ï¼Œç™½é£¯æ®ºæ‰‹", i: "gaprao" },
            { n: "è¶Šå—æ²³ç²‰", t: ["è¶Šå¼", "æ¸…çˆ½"], p: 1, f: ["soup", "light"], d: "æ¸…ç”œæ¹¯é ­é…æª¸æª¬", i: "pho" },
            { n: "æ³°å¼ç¶ å’–å“©", t: ["æ³°å¼", "æ¤°é¦™"], p: 2, f: ["soup", "spicy", "full"], d: "æ¿ƒéƒæ¤°å¥¶é¦™å¾®è¾£", i: "green_curry" },
            { n: "æœˆäº®è¦é¤…", t: ["æ³°å¼", "é…¥è„†"], p: 2, f: ["dry", "greasy", "light"], d: "å¤–é…¥å…§Qå½ˆ", i: "shrimp_cake" },
            { n: "æµ·å—é›é£¯", t: ["æ˜Ÿé¦¬", "å«©é›"], p: 1, f: ["dry", "greasy", "full"], d: "é›è‚‰æ»‘å«©ï¼Œé›æ²¹é£¯é¦™", i: "hainan_chicken" },
            { n: "å°åº¦å’–å“©", t: ["ç•°åœ‹", "é¦™æ–™"], p: 2, f: ["soup", "spicy", "full"], d: "é¦™æ–™å±¤æ¬¡è±å¯Œé…çƒ¤é¤…", i: "indian_curry" },
            
            // è£œå……åˆ° 60~ (ç”¨é¡ä¼¼çµæ§‹é‡è¤‡ç”Ÿæˆä¸åŒè®Šé«”ä»¥ç¢ºä¿æ•¸é‡ï¼Œé€™è£¡åˆ—å‡ºä»£è¡¨æ€§çš„ï¼Œå¯¦éš›ä»£ç¢¼é‚è¼¯æœƒè™•ç†)
            // ç‚ºäº†ç¯€çœç¯‡å¹…ï¼Œä»¥ä¸‹æˆ‘ç”¨ç¨‹å¼é‚è¼¯ç¢ºä¿è‡³å°‘æœ‰ 100 å€‹é¸é …ï¼ŒåŒ…å«é‡è¤‡é¡å‹çš„ä¸åŒè®Šé«”
            { n: "éº»è¾£ç‡™", t: ["ä¸­å¼", "å€‹äºº"], p: 1, f: ["soup", "spicy", "light"], d: "æƒ³åƒä»€éº¼å¤¾ä»€éº¼", i: "malatang" },
            { n: "é¹¹é…¥é›", t: ["å°å¼", "å®µå¤œ"], p: 1, f: ["dry", "greasy", "light"], d: "å°ç£å‘³ç‚¸ç‰©æ‹¼ç›¤", i: "popcorn_chicken" },
            { n: "æ¶¼éºµ", t: ["å°å¼", "æ¶ˆæš‘"], p: 1, f: ["dry", "light"], d: "éº»é†¬é¦™æ°£æ¿ƒéƒ", i: "cold_noodles" },
            { n: "éµæ¿ç‡’", t: ["å°å¼", "ç¾ç‚’"], p: 2, f: ["dry", "greasy", "full"], d: "å¸«å‚…ç¾ç‚’é’èœèˆ‡ä¸»é£Ÿ", i: "teppanyaki" },
            { n: "ç‚’é£¯", t: ["ä¸­å¼", "é‘Šæ°£"], p: 1, f: ["dry", "greasy", "full"], d: "ç²’ç²’åˆ†æ˜", i: "fried_rice" },
            { n: "ç‚’éºµ", t: ["å°å¼", "å®¶å¸¸"], p: 1, f: ["dry", "greasy", "full"], d: "å¤§ç«å¿«ç‚’é¦™æ°£", i: "fried_noodles" },
            { n: "ç±³ç²‰æ¹¯", t: ["å°å¼", "å°åƒ"], p: 1, f: ["soup", "light"], d: "ç²—ç±³ç²‰é…é»‘ç™½åˆ‡", i: "rice_noodle_soup" },
            { n: "è‚‰åœ“", t: ["å°å¼", "Qå½ˆ"], p: 1, f: ["dry", "greasy", "light"], d: "ä½æº«æ²¹æ³¡å¤–çš®Qå½ˆ", i: "meatball" },
            { n: "ç”œä¸è¾£", t: ["å°å¼", "ç…®ç‰©"], p: 1, f: ["soup", "light"], d: "åƒå®Œé‚„å¯ä»¥åŠ æ¹¯", i: "tempura_tw" },
            { n: "è—¥ç‡‰æ’éª¨", t: ["å°å¼", "å¤œå¸‚"], p: 1, f: ["soup", "full"], d: "æ¹¯é ­ç”˜ç”œä¸­è—¥é¦™", i: "herbal_ribs" },
            { n: "é—œæ±ç…®", t: ["æ—¥å¼", "æ¸…æ·¡"], p: 1, f: ["soup", "light"], d: "ä¾¿åˆ©å•†åº—çš„æº«æš–", i: "oden" },
            { n: "å¤å¨å¤·æ‹Œé£¯(Poke)", t: ["ç¾å¼", "ç”Ÿé£Ÿ"], p: 2, f: ["dry", "light"], d: "åŸå‹é£Ÿç‰©å¥åº·é¸æ“‡", i: "poke" },
            { n: "ç‡’è‡˜ä¾¿ç•¶", t: ["æ¸¯å¼", "æ²¹é›"], p: 1, f: ["dry", "greasy", "full"], d: "è”¥æ²¹é…ä¸Šç‡’é´¨æ²¹é›", i: "roast_duck" },
            { n: "æ¸¯å¼é»å¿ƒ", t: ["æ¸¯å¼", "é£²èŒ¶"], p: 2, f: ["dry", "light"], d: "ç‡’è³£ã€è¦é¤ƒã€å‰ç‡’åŒ…", i: "dimsum" },
            { n: "èŒ¶é¤å»³", t: ["æ¸¯å¼", "å¿«é¤"], p: 2, f: ["dry", "greasy", "full"], d: "å…¬ä»”éºµã€æ³¢è˜¿æ²¹", i: "hk_cafe" },
            { n: "æ¼¢å ¡ç‹", t: ["ç¾å¼", "ç«çƒ¤"], p: 1, f: ["dry", "greasy", "full"], d: "ç«çƒ¤ç‰›è‚‰é¦™æ°£", i: "burger_king" },
            { n: "éº¥ç•¶å‹", t: ["ç¾å¼", "ç¶“å…¸"], p: 1, f: ["dry", "greasy", "full"], d: "è–¯æ¢æ˜¯æœ¬é«”", i: "mcdonalds" },
            { n: "æ‘©æ–¯æ¼¢å ¡", t: ["æ—¥å¼", "ç±³æ¼¢å ¡"], p: 2, f: ["dry", "light"], d: "ç¾é»ç¾åšç´…èŒ¶å¥½å–", i: "mos_burger" },
            { n: "å¿…å‹å®¢", t: ["ç¾å¼", "èšé¤"], p: 2, f: ["dry", "greasy", "full"], d: "é¬†åšé¤…çš®", i: "pizzahut" },
            { n: "æ‹¿å¡é‡Œç‚¸é›", t: ["ç¾©å¼", "è¢«è€½èª¤"], p: 2, f: ["dry", "greasy", "full"], d: "ç‚¸é›æ¯”æŠ«è–©å¥½åƒ", i: "fried_chicken_2" },
            { n: "ç´ é£Ÿè‡ªåŠ©é¤", t: ["ç´ é£Ÿ", "å¥åº·"], p: 1, f: ["dry", "light"], d: "å¤šæ¨£è”¬èœé¸æ“‡", i: "veggie_buffet" },
            { n: "è”¬é£Ÿç«é‹", t: ["ç´ é£Ÿ", "æ¸…æ·¡"], p: 2, f: ["soup", "light"], d: "å¤§é‡è‡é¡èˆ‡è”¬èœ", i: "veggie_pot" }
        ];

        // è‡ªå‹•æ“´å……è³‡æ–™åº«åˆ° 100+ (é€éçµ„åˆè®Šé«”)
        // ç‚ºäº†ç¢ºä¿ä¸é‡è¤‡ä¸”çœŸå¯¦ï¼Œæˆ‘å€‘æ‰‹å‹•å¢åŠ æ›´å¤šå¸¸è¦‹é¸é …
        const extraFoods = [
            {n:"é…¸èœç™½è‚‰é‹",t:["ä¸­å¼"],p:3,f:["soup","full"]}, {n:"ç ‚é‹é­šé ­",t:["å°å¼"],p:3,f:["soup","greasy","full"]},
            {n:"ç¾Šè‚‰ç‚’éºµ",t:["å°å¼"],p:1,f:["dry","greasy","full"]}, {n:"é±”é­šæ„éºµ",t:["å°å¼"],p:2,f:["dry","sweet","full"]},
            {n:"ç•¶æ­¸é´¨éºµç·š",t:["å°å¼"],p:1,f:["soup","full"]}, {n:"åœŸé­ é­šç¾¹",t:["å°å¼"],p:1,f:["soup","greasy","full"]},
            {n:"é­·é­šç¾¹",t:["å°å¼"],p:1,f:["soup","full"]}, {n:"è‚‰ç¾¹éºµ",t:["å°å¼"],p:1,f:["soup","full"]},
            {n:"å‰²åŒ…",t:["å°å¼"],p:1,f:["dry","greasy","light"]}, {n:"å››ç¥æ¹¯",t:["å°å¼"],p:1,f:["soup","light"]},
            {n:"ç¢—ç²¿",t:["å°å¼"],p:1,f:["dry","light"]}, {n:"ç­’ä»”ç±³ç³•",t:["å°å¼"],p:1,f:["dry","full"]},
            {n:"é›æ’",t:["å°å¼"],p:1,f:["dry","greasy","light"]}, {n:"åœ°ç“œçƒ",t:["å°å¼"],p:1,f:["dry","light"]},
            {n:"è±†èŠ±",t:["ç”œé»"],p:1,f:["soup","light"]}, {n:"ç‡’ä»™è‰",t:["ç”œé»"],p:1,f:["soup","light"]},
            {n:"å‰‰å†°",t:["ç”œé»"],p:1,f:["soup","light"]}, {n:"å¯éº—é¤…",t:["ç”œé»"],p:1,f:["dry","light"]},
            {n:"é›è›‹ç³•",t:["ç”œé»"],p:1,f:["dry","light"]}, {n:"è»Šè¼ªé¤…",t:["ç”œé»"],p:1,f:["dry","light"]},
            {n:"æ‹‰éºµ(ä¸€è˜­)",t:["æ—¥å¼"],p:2,f:["soup","greasy","full"]}, {n:"å£½å¸éƒ",t:["æ—¥å¼"],p:2,f:["dry","light"]},
            {n:"è—å£½å¸",t:["æ—¥å¼"],p:2,f:["dry","light"]}, {n:"å®šé£Ÿ8",t:["æ—¥å¼"],p:1,f:["dry","full"]},
            {n:"å‰é‡å®¶",t:["æ—¥å¼"],p:1,f:["dry","full"]}, {n:"ã™ãå®¶(Sukiya)",t:["æ—¥å¼"],p:1,f:["dry","full"]},
            {n:"é®®äº”ä¸¼",t:["æ—¥å¼"],p:1,f:["dry","full"]}, {n:"å¤§æˆ¶å±‹",t:["æ—¥å¼"],p:2,f:["dry","full"]},
            {n:"å‹åšæ®¿",t:["æ—¥å¼"],p:3,f:["dry","greasy","full"]}, {n:"ç“¦åŸ",t:["æ³°å¼"],p:3,f:["dry","spicy","full"]},
            {n:"æ¶“è±†è…",t:["éŸ“å¼"],p:2,f:["soup","spicy","full"]}, {n:"å…©é¤",t:["éŸ“å¼"],p:1,f:["soup","spicy","full"]},
            {n:"æµ·åº•æ’ˆ",t:["ä¸­å¼"],p:3,f:["soup","spicy","full"]}, {n:"é¼æ³°è±",t:["ä¸­å¼"],p:3,f:["dry","light"]},
            {n:"æ˜¥æ°´å ‚",t:["å°å¼"],p:2,f:["dry","full"]}, {n:"é¬é¬šå¼µ",t:["å°å¼"],p:2,f:["dry","greasy","full"]},
            {n:"å…«æ–¹é›²é›†",t:["å°å¼"],p:1,f:["dry","full"]}, {n:"å››æµ·éŠé¾",t:["å°å¼"],p:1,f:["dry","full"]},
            {n:"ä¸‰å•†å·§ç¦",t:["å°å¼"],p:1,f:["soup","full"]}, {n:"æ‹¿å¡é‡Œ",t:["ç¾©å¼"],p:2,f:["dry","greasy","full"]},
            {n:"é”ç¾æ¨‚",t:["ç¾©å¼"],p:2,f:["dry","greasy","full"]}, {n:"IKEAé¤å»³",t:["ç‘å…¸"],p:2,f:["dry","full"]},
            {n:"Costcoç†Ÿé£Ÿ",t:["ç¾å¼"],p:1,f:["dry","greasy","full"]}, {n:"7-11å¾®æ³¢",t:["è¶…å•†"],p:1,f:["dry","full"]},
            {n:"å…¨å®¶å¾®æ³¢",t:["è¶…å•†"],p:1,f:["dry","full"]}, {n:"è·¯æ˜“èè¼•é£Ÿ",t:["å’–å•¡"],p:1,f:["dry","light"]},
            {n:"æ˜Ÿå·´å…‹è¼•é£Ÿ",t:["å’–å•¡"],p:2,f:["dry","light"]}, {n:"Camaè¼•é£Ÿ",t:["å’–å•¡"],p:1,f:["dry","light"]}
        ];
        
        // åˆä½µæ‰€æœ‰æ•¸æ“šä¸¦è£œé½Šé è¨­å€¼
        const fullDB = [...db, ...extraFoods].map(item => ({
            name: item.n,
            tags: item.t,
            price: item.p,
            features: item.f || [], // soup, dry, spicy, greasy, full, light
            desc: item.d || "ç¶“å…¸ç¾å‘³ï¼Œå€¼å¾—ä¸€è©¦",
            // ä½¿ç”¨ Unsplash Source æŠ“å–éš¨æ©Ÿç¾é£Ÿåœ–ï¼Œé¿å…ç ´åœ–
            img: `https://source.unsplash.com/featured/?food,${item.i || 'meal'}`
        }));

        // === ç‹€æ…‹ç®¡ç† ===
        let state = {
            step: 'hunger', // hunger, mood, budget, swipe, podium, result
            filters: {},    // { hunger: 'light', mood: 'soup', budget: 1 }
            candidates: [], // ç¯©é¸å¾Œçš„æ¸…å–®
            shortlist: [],  // æœ€çµ‚å…¥é¸çš„ 3 å®¶
            currentIndex: 0
        };

        // === é‚è¼¯æ§åˆ¶ ===
        function nextStep(category, value) {
            state.filters[category] = value;
            
            // åˆ‡æ›è¦–åœ–
            document.querySelector('.view.active').classList.remove('active');
            
            if (category === 'hunger') {
                document.getElementById('v-mood').classList.add('active');
            } else if (category === 'mood') {
                document.getElementById('v-budget').classList.add('active');
            } else if (category === 'budget') {
                // é–‹å§‹ç¯©é¸è³‡æ–™
                filterCandidates();
                document.getElementById('v-swipe').classList.add('active');
                document.getElementById('counter').style.display = 'block';
                renderCard();
            }
        }

        // æ™ºæ…§ç¯©é¸é‚è¼¯ (ç¢ºä¿ä¸ç‚ºç©º)
        function filterCandidates() {
            let list = fullDB.filter(item => {
                let score = 0;
                // 1. é£¢é¤“åº¦ç¯©é¸
                if (state.filters.hunger === 'light' && item.features.includes('light')) score += 2;
                if (state.filters.hunger === 'full' && item.features.includes('full')) score += 2;
                if (state.filters.hunger === 'any') score += 1;

                // 2. å¿ƒæƒ…ç¯©é¸
                if (state.filters.mood === 'soup' && item.features.includes('soup')) score += 3;
                if (state.filters.mood === 'dry' && item.features.includes('dry')) score += 3;
                if (state.filters.mood === 'spicy' && item.features.includes('spicy')) score += 3;
                if (state.filters.mood === 'any') score += 1;

                // 3. é ç®—ç¯©é¸ (å¯¬å®¹æ¨¡å¼: é ç®—ç¬¦åˆ+1ï¼Œå¦‚æœæ˜¯0å‰‡å…¨ç¬¦åˆ)
                if (state.filters.budget === 0 || item.price === state.filters.budget) score += 2;
                // é ç®—ç›¸å·®1ç´šä¹Ÿå¯ä»¥æ¥å—ï¼Œä½†åˆ†æ•¸è¼ƒä½
                else if (Math.abs(item.price - state.filters.budget) === 1) score += 1;

                item.matchScore = score;
                return true; // å…ˆä¿ç•™æ‰€æœ‰ï¼Œå¾Œé¢ç”¨åˆ†æ•¸æ’åº
            });

            // æ ¹æ“šåˆ†æ•¸æ’åºï¼Œå–å‰ 30 åäº‚æ•¸æ´—ç‰Œ (é¿å…æ¯æ¬¡éƒ½ä¸€æ¨£)
            list.sort((a, b) => b.matchScore - a.matchScore);
            let topList = list.slice(0, 40); // å–é«˜åˆ†ç¾¤
            state.candidates = shuffle(topList);
            state.currentIndex = 0;
        }

        // æ¸²æŸ“å¡ç‰‡
        function renderCard() {
            const container = document.getElementById('cardStack');
            container.innerHTML = '';
            
            if (state.currentIndex >= state.candidates.length) {
                // å¡ç‰‡ç”¨å®Œäº†ä½†æ²’é›†æ»¿ï¼Œç›´æ¥å»æ±ºé¸
                if (state.shortlist.length > 0) {
                    showPodium();
                } else {
                    container.innerHTML = '<div class="empty-msg">æ²’æœ‰ç¬¦åˆçš„é¸é …äº†...<br>è«‹æ”¾å¯¬æ¢ä»¶é‡è©¦</div><div style="text-align:center;margin-top:20px;"><button class="option-btn" onclick="location.reload()">é‡ä¾†</button></div>';
                }
                return;
            }

            const item = state.candidates[state.currentIndex];
            
            // æ§‹å»ºå¡ç‰‡ HTML
            const card = document.createElement('div');
            card.className = 'food-card';
            card.innerHTML = `
                <div class="card-img" style="background-image: url('${item.img}&sig=${Math.random()}')"></div>
                <div class="card-content">
                    <div class="card-title">${item.name}</div>
                    <div class="tags">
                        ${item.tags.map(t => `<span class="tag">${t}</span>`).join('')}
                        <span class="tag" style="background:#FFF3E0;color:#F57C00">${'$'.repeat(item.price)}</span>
                    </div>
                    <div class="desc">${item.desc}</div>
                    <div class="filter-tags">
                        <div class="filter-chip" onclick="quickFilter('greasy')">ğŸ¥¦ å¤ªæ²¹è†©</div>
                        <div class="filter-chip" onclick="quickFilter('spicy')">ğŸŒ¶ï¸ ä¸åƒè¾£</div>
                        <div class="filter-chip" onclick="quickFilter('full')">ğŸ é€™å¤ªé£½</div>
                    </div>
                </div>
            `;
            container.appendChild(card);
        }

        // æ»‘å‹•è™•ç†
        function handleSwipe(isLike) {
            const item = state.candidates[state.currentIndex];
            
            if (isLike) {
                state.shortlist.push(item);
                updateCounter();
            }

            state.currentIndex++;
            
            // é›†æ»¿3å€‹å»æ±ºé¸
            if (state.shortlist.length >= 3) {
                showPodium();
            } else {
                renderCard();
            }
        }

        // å¿«é€Ÿéæ¿¾ (å¡ç‰‡ä¸Šçš„å°æŒ‰éˆ•)
        function quickFilter(tag) {
            // å¾å‰©é¤˜å€™é¸åå–®ä¸­ç§»é™¤å¸¶æœ‰æ­¤æ¨™ç±¤çš„
            state.candidates = state.candidates.filter((item, index) => {
                if (index <= state.currentIndex) return true; // å·²éçš„ä¸ç®¡
                return !item.features.includes(tag);
            });
            // è·³éé€™å¼µ (å› ç‚ºä½¿ç”¨è€…èªªä¸å–œæ­¡é€™å€‹ç‰¹æ€§)
            handleSwipe(false);
        }

        function updateCounter() {
            document.getElementById('counter').innerText = `â¤ï¸ ${state.shortlist.length} / 3`;
        }

        // === æ±ºé¸æ“‚å° ===
        function showPodium() {
            document.querySelector('.view.active').classList.remove('active');
            document.getElementById('v-swipe').style.display = 'none'; // å¼·åˆ¶éš±è—
            document.getElementById('v-podium').classList.add('active');
            document.getElementById('counter').style.display = 'none';

            const list = document.getElementById('podiumList');
            list.innerHTML = '';
            
            state.shortlist.forEach(item => {
                const div = document.createElement('div');
                div.className = 'podium-item';
                div.onclick = () => showResult(item);
                div.innerHTML = `
                    <div class="p-img" style="background-image: url('${item.img}&sig=${Math.random()}')"></div>
                    <div class="p-info">
                        <div class="p-name">${item.name}</div>
                        <div class="p-desc">${item.desc}</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color:#ddd"></i>
                `;
                list.appendChild(div);
            });
        }

        function randomPick() {
            const winner = state.shortlist[Math.floor(Math.random() * state.shortlist.length)];
            showResult(winner);
        }

        // === æœ€çµ‚çµæœ ===
        function showResult(item) {
            document.querySelector('.view.active').classList.remove('active');
            document.getElementById('v-result').classList.add('active');
            
            document.getElementById('resName').innerText = item.name;
            document.getElementById('resImg').style.backgroundImage = `url('${item.img}&sig=${Math.random()}')`;
            
            document.getElementById('resTags').innerHTML = 
                item.tags.map(t => `<span class="tag">${t}</span>`).join('') +
                `<span class="tag" style="background:#FFF3E0;color:#F57C00">${'$'.repeat(item.price)}</span>`;

            // Google Maps æœå°‹é€£çµ
            const query = encodeURIComponent(item.name + " é™„è¿‘");
            document.getElementById('resLink').href = `https://www.google.com/maps/search/?api=1&query=${query}`;
        }

        // å·¥å…·: æ´—ç‰Œç®—æ³•
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

    </script>
</body>
</html>