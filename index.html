<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä»Šå¤©åƒä»€éº¼ï¼ŸV3.1</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* è«è˜­è¿ª V3 */
            --bg: #F5F7F6;
            --card: #FFFFFF;
            --primary: #7A9CA5;
            --secondary: #A5B59C;
            --accent: #D49A89;
            --text: #555555;
            --shadow: 0 8px 30px rgba(122, 156, 165, 0.15);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: 'Noto Sans TC', sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            height: 100vh; /* å›ºå®šé«˜åº¦ */
            height: -webkit-fill-available; /* è§£æ±º Safari 100vh å•é¡Œ */
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }

        /* === é ‚éƒ¨ === */
        .header { 
            padding: 15px 20px; z-index: 10; display: flex; 
            justify-content: space-between; align-items: center; 
            padding-top: max(15px, env(safe-area-inset-top)); /* é¿é–‹ç€æµ· */
        }
        .app-logo { font-size: 18px; font-weight: bold; color: var(--primary); letter-spacing: 1px; }
        
        .wishlist-counter {
            background: white; padding: 6px 14px; border-radius: 20px;
            font-size: 14px; font-weight: bold; color: var(--accent);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: transform 0.2s;
        }
        .wishlist-counter.bump { transform: scale(1.2); }

        /* === ä¸»èˆå° === */
        .main-stage {
            flex: 1; position: relative; width: 100%; max-width: 400px; margin: 0 auto;
            display: flex; flex-direction: column; justify-content: center; 
            padding: 10px 20px;
            padding-bottom: 0; /* åº•éƒ¨ç©ºé–“äº¤çµ¦ controls è™•ç† */
        }

        /* ç€è¦½æ¨¡å¼ */
        .browse-mode { 
            display: flex; flex-direction: column; height: 100%; 
            position: relative;
        }
        
        .food-card {
            background: var(--card); border-radius: 24px; overflow: hidden;
            box-shadow: var(--shadow); 
            flex: 1; /* ä½”æ»¿å‰©é¤˜ç©ºé–“ */
            display: flex; flex-direction: column;
            position: relative; animation: popIn 0.3s; 
            margin-bottom: 20px; /* èˆ‡æŒ‰éˆ•å€çš„é–“è· */
        }
        .food-img-box { height: 45%; position: relative; background: #eee; }
        .food-img { width: 100%; height: 100%; object-fit: cover; }
        .price-badge {
            position: absolute; bottom: 10px; right: 10px;
            background: rgba(255,255,255,0.9); color: var(--text); padding: 4px 10px;
            border-radius: 20px; font-size: 12px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .food-content { padding: 20px; flex: 1; overflow-y: auto; }
        .food-title { font-size: 24px; font-weight: bold; margin-bottom: 5px; color: var(--text); }
        .food-desc { font-size: 14px; color: #888; line-height: 1.5; margin-bottom: 15px; }
        
        .tag-row { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 15px; }
        .info-tag { background: #EDF2F4; padding: 4px 10px; border-radius: 8px; font-size: 12px; color: #666; }

        /* === é—œéµä¿®æ­£ï¼šåº•éƒ¨æŒ‰éˆ•å€ === */
        .bottom-controls {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px;
            /* é€™è£¡å¾ˆé‡è¦ï¼šçµ¦äºˆåº•éƒ¨è¶³å¤ çš„ç·©è¡ç©ºé–“ï¼Œé¿é–‹ Safari ç¶²å€åˆ— */
            padding-bottom: max(30px, env(safe-area-inset-bottom)); 
            width: 100%; max-width: 400px; margin: 0 auto;
            position: relative; z-index: 20;
        }
        .big-btn {
            width: 65px; height: 65px; border-radius: 50%; border: none;
            font-size: 24px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.1s;
        }
        .big-btn:active { transform: scale(0.9); }
        .btn-pass { background: white; color: var(--gray); border: 1px solid #eee; }
        .btn-keep { background: var(--accent); color: white; width: 75px; height: 75px; font-size: 28px; box-shadow: 0 8px 20px rgba(214, 140, 140, 0.4); }

        /* === æ±ºé¸æ“‚å° === */
        .shortlist-mode { display: none; height: 100%; flex-direction: column; }
        .shortlist-mode.show { display: flex; animation: fadeIn 0.5s; }
        
        .mode-title { font-size: 22px; font-weight: bold; color: var(--primary); text-align: center; margin-bottom: 5px; }
        .mode-desc { text-align: center; color: #999; font-size: 13px; margin-bottom: 20px; }

        .pk-container { flex: 1; overflow-y: auto; padding-bottom: 20px; }
        .pk-card {
            background: white; border-radius: 16px; padding: 10px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            cursor: pointer; transition: all 0.2s; border: 2px solid transparent;
        }
        .pk-card.selected { border-color: var(--primary); background: #F0F5F7; }
        .pk-img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; }
        .pk-info { flex: 1; }
        .pk-name { font-weight: bold; font-size: 16px; color: var(--text); }
        .pk-meta { font-size: 12px; color: #999; margin-top: 2px; }

        .final-actions { 
            text-align: center; margin-top: auto; 
            padding-bottom: max(30px, env(safe-area-inset-bottom)); /* é¿é–‹åº•éƒ¨ */
        }
        .btn-final {
            background: var(--primary); color: white; border: none; padding: 15px 40px;
            border-radius: 30px; font-size: 16px; font-weight: bold; width: 100%;
            box-shadow: 0 5px 15px rgba(122, 156, 165, 0.3);
        }
        .btn-random-pick {
            background: white; color: var(--secondary); border: 2px solid var(--secondary);
            margin-top: 10px;
        }

        /* æˆåŠŸç•«é¢ */
        .success-overlay {
            position: fixed; inset: 0; background: white; z-index: 100;
            display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px;
        }
        .success-overlay.show { display: flex; animation: fadeIn 0.5s; }
        .final-img { width: 160px; height: 160px; border-radius: 50%; object-fit: cover; margin-bottom: 25px; box-shadow: var(--shadow); border: 5px solid white; }
        
        /* å¿«é€Ÿç¯©é¸ä¸¸ */
        .quick-actions { margin-top: 10px; display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .quick-actions::-webkit-scrollbar { display: none; }
        .chip-btn { white-space: nowrap; padding: 6px 12px; border-radius: 15px; border: 1px solid #E0E0E0; background: white; color: #888; font-size: 12px; flex-shrink: 0; }

        /* Loading */
        .loading-screen { position: fixed; inset: 0; background: var(--bg); z-index: 200; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
        .loading-screen.hide { opacity: 0; pointer-events: none; }

        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="loading" class="loading-screen">
        <i class="fas fa-utensils fa-spin" style="font-size:40px; color:var(--primary);"></i>
    </div>

    <div class="header">
        <div class="app-logo">WHAT TO EAT</div>
        <div id="wishCounter" class="wishlist-counter">â¤ï¸ 0 / 3</div>
    </div>

    <div class="main-stage">
        
        <div id="browseMode" class="browse-mode">
            <div id="cardContainer" class="food-card">
                <div class="food-img-box">
                    <img id="fImg" class="food-img" src="">
                    <span id="fPrice" class="price-badge">$$</span>
                </div>
                <div class="food-content">
                    <div id="fName" class="food-title">è¼‰å…¥ä¸­...</div>
                    <div class="tag-row" id="fTags"></div>
                    <div id="fDesc" class="food-desc"></div>
                    
                    <div style="font-size:12px; font-weight:bold; color:var(--primary); margin-bottom:5px;">éæ¿¾æ‰ï¼š</div>
                    <div class="quick-actions">
                        <div class="chip-btn" onclick="filterOut('cat')">ğŸš« é€™é¡å…ˆä¸è¦</div>
                        <div class="chip-btn" onclick="filterOut('heavy')">ğŸ¥¦ å¤ªæ²¹è†©</div>
                        <div class="chip-btn" onclick="filterOut('spicy')">ğŸŒ¶ï¸ ä¸åƒè¾£</div>
                        <div class="chip-btn" onclick="filterOut('expensive')">ğŸ’¸ å¤ªè²´</div>
                    </div>
                </div>
            </div>

            <div class="bottom-controls">
                <button class="big-btn btn-pass" onclick="nextCard()">
                    <i class="fas fa-times"></i>
                </button>
                <div style="font-size:12px; color:#999; text-align:center;">
                    æ›ä¸€å¼µ<br>Next
                </div>
                <button class="big-btn btn-keep" onclick="addToWishlist()">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
        </div>

        <div id="shortlistMode" class="shortlist-mode">
            <div class="mode-title">æ±ºé¸æ“‚å° ğŸ‘‘</div>
            <div class="mode-desc">é€™ 3 å®¶ä½ éƒ½æƒ³åƒï¼Œé¸ä¸€å®¶æœ€æƒ³å»çš„ï¼</div>
            <div id="pkList" class="pk-container"></div>
            <div class="final-actions">
                <button class="btn-final btn-random-pick" onclick="randomPickFinal()">
                    ğŸ² å¹«æˆ‘é¸ï¼
                </button>
            </div>
        </div>

    </div>

    <div id="successOverlay" class="success-overlay">
        <img id="finalImg" class="final-img">
        <h2 style="color:var(--primary); margin-bottom:5px;">ä»Šæ™šå°±åƒé€™å€‹ï¼</h2>
        <h1 id="finalName" style="font-size:32px; margin:0 0 20px 0;"></h1>
        <p style="color:#666;">åˆ¥å†çŒ¶è±«äº†ï¼Œç¾åœ¨å°±å‡ºç™¼ï¼</p>
        <a id="mapLink" href="#" target="_blank" class="btn-final" style="display:flex; align-items:center; justify-content:center; text-decoration:none;">
            <i class="fas fa-location-arrow" style="margin-right:10px;"></i> Google Maps å°èˆª
        </a>
        <div style="margin-top:30px; color:#999; text-decoration:underline; cursor:pointer;" onclick="location.reload()">é‡ç©ä¸€æ¬¡</div>
    </div>

    <script>
        // === è³‡æ–™åº« (50+ å®Œæ•´ç‰ˆ) ===
        const database = [
            { name: "æ»·è‚‰é£¯", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1627207644063-267926715201?w=600", desc: "åœ‹æ°‘ç¾é£Ÿï¼Œè‚¥ç˜¦æ»·æ±æ·‹åœ¨ç™½é£¯ä¸Šï¼Œç°¡å–®å»éŠ·é­‚ã€‚" },
            { name: "ç´…ç‡’ç‰›è‚‰éºµ", cat: "å°å¼", price: 2, heavy: true, soup: true, spicy: true, img: "https://images.unsplash.com/photo-1596458397260-255551c09534?w=600", desc: "æ¿ƒéƒæ¹¯é ­é…ä¸Šå¤§å¡Šç‰›è‚‰ï¼Œå°ç£ä¹‹å…‰ã€‚" },
            { name: "ä¹¾éºµ + æ»·å‘³", cat: "å°å¼", price: 1, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1552611052-33e04de081de?w=600", desc: "ç°¡å–®çš„éº»é†¬æˆ–ç‚¸é†¬éºµï¼Œé…é»è±†å¹²æµ·å¸¶ã€‚" },
            { name: "å¤§é›æ’ + çå¥¶", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600", desc: "ç‚¸å¾—é‡‘é»ƒé…¥è„†ï¼Œç½ªæƒ¡æ„Ÿèˆ‡å¹¸ç¦æ„ŸåŒæ™‚çˆ†è¡¨ã€‚" },
            { name: "è„†çš®è‡­è±†è…", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1583069358212-04e8d89ce58a?w=600", desc: "å¤–é…¥å…§å«©ï¼Œå¡å…¥æ³¡èœä¸€å£å’¬ä¸‹ï¼Œçµ•é…ã€‚" },
            { name: "å°å¼ç†±ç‚’", cat: "å°å¼", price: 2, heavy: true, soup: false, spicy: true, img: "https://images.unsplash.com/photo-1551249721-a4b51cc13075?w=600", desc: "å®®ä¿é›ä¸ã€é³³æ¢¨è¦çƒï¼Œé…å•¤é…’æœ€å°å‘³ã€‚" },
            { name: "ç«é›è‚‰é£¯", cat: "å°å¼", price: 1, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1606525437679-037aca74a3e9?w=600", desc: "é®®å«©ç«é›è‚‰çµ²æ·‹ä¸Šé›æ²¹ï¼Œé¦™æ°£å››æº¢ã€‚" },
            { name: "æº«å·å¤§é¤›é£©", cat: "å°å¼", price: 1, heavy: false, soup: true, spicy: false, img: "https://images.unsplash.com/photo-1596458397223-93c66f25459b?w=600", desc: "çš®è–„é¤¡å¤§ï¼ŒåŠ é»ç´…æ²¹æŠ„æ‰‹æ›´éç™®ã€‚" },
            { name: "æ¶¼éºµ", cat: "å°å¼", price: 1, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1594975519808-8df04405362a?w=600", desc: "éº»é†¬é¦™æ°£é…ä¸Šå°é»ƒç“œï¼Œå¤å¤©å¿…åƒçµ„åˆã€‚" },
            { name: "æ°´é¤ƒ / é‹è²¼", cat: "å°å¼", price: 1, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1534422298391-e4f8c172dddb?w=600", desc: "çš®è–„é¤¡å¤šï¼Œæ²¾é†¬æ²¹é†‹æœ€å°å‘³ã€‚" },
            { name: "æ—¥å¼æ‹‰éºµ", cat: "æ—¥å¼", price: 2, heavy: true, soup: true, spicy: false, img: "https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=600", desc: "æ¿ƒéƒæ¹¯é ­é…ä¸Šå‹é“éºµæ¢ï¼Œæš–å¿ƒé¦–é¸ã€‚" },
            { name: "è¿´è½‰å£½å¸", cat: "æ—¥å¼", price: 2, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600", desc: "æ¸…çˆ½ç„¡è² æ“”ï¼Œæƒ³åƒå¤šå°‘æ‹¿å¤šå°‘ã€‚" },
            { name: "ç‚¸è±¬æ’å®šé£Ÿ", cat: "æ—¥å¼", price: 2, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1616428467478-43d969248232?w=600", desc: "å¤–é…¥å…§å«©çš„åšåˆ‡è±¬æ’ï¼Œé…ä¸Šé«˜éº—èœçµ²ã€‚" },
            { name: "ç‰›ä¸¼", cat: "æ—¥å¼", price: 1, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1554502078-ef0fc409efce?w=600", desc: "å¤§ç¢—è‚‰ç‰‡é‹ªåœ¨é£¯ä¸Šï¼Œå¿«é€Ÿæ»¿è¶³ã€‚" },
            { name: "æ—¥å¼å’–å“©", cat: "æ—¥å¼", price: 2, heavy: true, soup: true, spicy: false, img: "https://images.unsplash.com/photo-1604152135912-04a022e23696?w=600", desc: "æ¿ƒéƒç”˜ç”œçš„æ—¥å¼å’–å“©ï¼Œå¤§äººå°å­©éƒ½æ„›ã€‚" },
            { name: "çƒé¾éºµ", cat: "æ—¥å¼", price: 1, heavy: false, soup: true, spicy: false, img: "https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=600", desc: "Qå½ˆæ»‘é †çš„éºµæ¢ï¼Œé…ä¸Šç‚¸ç‰©å¤©å©¦ç¾…ã€‚" },
            { name: "æ—¥å¼ç‡’è‚‰", cat: "æ—¥å¼", price: 3, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1592685829283-7c0bb77df3c9?w=600", desc: "äº«å—è‡ªå·±å‹•æ‰‹çƒ¤è‚‰çš„æ¨‚è¶£ï¼Œè‚‰é£Ÿè€…å¤©å ‚ã€‚" },
            { name: "å±…é…’å±‹ä¸²ç‡’", cat: "æ—¥å¼", price: 3, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1534604973900-c43ab4c2e0ab?w=600", desc: "ä¸‹ç­å¾Œçš„å°é…Œæ™‚å…‰ï¼Œç‚­ç«é¦™æ°£è¿·äººã€‚" },
            { name: "ç”Ÿé­šç‰‡ä¸¼é£¯", cat: "æ—¥å¼", price: 3, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1562436260-8c9216eeb703?w=600", desc: "æ»¿æ»¿çš„æ–°é®®æµ·é®®é‹ªåœ¨é†‹é£¯ä¸Šï¼Œè±ªè¯äº«å—ã€‚" },
            { name: "å¤©å©¦ç¾…ä¸¼", cat: "æ—¥å¼", price: 2, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1560155016-16e6c1cc3e53?w=600", desc: "è±ªé‚çš„ç‚¸è¦èˆ‡è”¬èœï¼Œæ·‹ä¸Šé¹¹ç”œé†¬æ±ã€‚" },
            { name: "éº¥ç•¶å‹", cat: "é€Ÿé£Ÿ", price: 1, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=600", desc: "ç†Ÿæ‚‰çš„å‘³é“ï¼Œè–¯æ¢æ˜¯æœ¬é«”ã€‚" },
            { name: "è‚¯å¾·åŸº KFC", cat: "é€Ÿé£Ÿ", price: 1, heavy: true, soup: false, spicy: true, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600", desc: "æƒ³åƒç‚¸é›å’Œè›‹å¡”çš„æ™‚å€™ï¼Œé€™æ˜¯ä¸äºŒä¹‹é¸ã€‚" },
            { name: "æŠ«è–© Pizza", cat: "è¥¿å¼", price: 2, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1513104890138-7c749659a591?w=600", desc: "ç‰½çµ²çš„èµ·å¸èˆ‡é…¥è„†é¤…çš®ï¼Œèšé¤é¦–é¸ã€‚" },
            { name: "Subway", cat: "è¥¿å¼", price: 1, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1509722747741-092075b55909?w=600", desc: "æ»¿æ»¿è”¬èœçš„æ½›è‰‡å ¡ï¼Œå¥åº·åˆæ–¹ä¾¿ã€‚" },
            { name: "ç¾©å¤§åˆ©éºµ", cat: "è¥¿å¼", price: 2, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?w=600", desc: "å¥¶æ²¹ã€é’é†¬æˆ–ç•ªèŒ„ï¼Œå£å‘³å¤šè®Šã€‚" },
            { name: "ç¾å¼æ—©åˆé¤", cat: "è¥¿å¼", price: 2, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1533089862017-5614ecb3f2f2?w=600", desc: "ç­å°¼è¿ªå…‹è›‹é…å’–å•¡ï¼Œæ‚ é–’çš„ä¸€é¤ã€‚" },
            { name: "ç‰›æ’é¤¨", cat: "è¥¿å¼", price: 3, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1600891964092-4316c288032e?w=600", desc: "æ…¶ç¥ç¯€æ—¥æˆ–çŠ’è³è‡ªå·±çš„å¥½é¸æ“‡ã€‚" },
            { name: "ç¾å¼æ¼¢å ¡", cat: "è¥¿å¼", price: 2, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=600", desc: "æ‰‹å·¥è‚‰æ’å¤šæ±åšå¯¦ï¼Œå¤§å£å’¬ä¸‹è¶…æ»¿è¶³ã€‚" },
            { name: "å¥åº·é¤ç›’", cat: "å¥åº·", price: 2, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=600", desc: "æ°´ç…®ä½å¡ï¼Œå¢è‚Œæ¸›è„‚é¦–é¸ã€‚" },
            { name: "éº»è¾£ç«é‹", cat: "ç«é‹", price: 3, heavy: true, soup: true, spicy: true, img: "https://images.unsplash.com/photo-1582236357997-6a422a57ae22?w=600", desc: "é¦™è¾£éç™®ï¼Œé©åˆé‡å£å‘³èˆ‡èšé¤ã€‚" },
            { name: "å€‹äººå°ç«é‹", cat: "ç«é‹", price: 1, heavy: true, soup: true, spicy: false, img: "https://images.unsplash.com/photo-1547592166-23acbe34071b?w=600", desc: "ä¸€å€‹äººä¹Ÿèƒ½æš–æš–åƒé‹ï¼ŒCPå€¼é«˜ã€‚" },
            { name: "éŸ“å¼ç‚¸é›", cat: "éŸ“å¼", price: 2, heavy: true, soup: false, spicy: true, img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=600", desc: "è£¹æ»¿ç”œè¾£é†¬æ±çš„é…¥è„†ç‚¸é›ï¼Œé…é†ƒè˜¿è””ã€‚" },
            { name: "éŸ“å¼æ³¡èœé‹", cat: "éŸ“å¼", price: 2, heavy: false, soup: true, spicy: true, img: "https://images.unsplash.com/photo-1596458397260-255551c09534?w=600", desc: "é…¸è¾£é–‹èƒƒï¼Œé…ä¸Šä¸€ç¢—ç™½é£¯å‰›å‰›å¥½ã€‚" },
            { name: "çŸ³é‹æ‹Œé£¯", cat: "éŸ“å¼", price: 2, heavy: false, soup: false, spicy: true, img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600", desc: "é…¥è„†é‹å·´é…ä¸Šè±å¯Œé…èœï¼Œæ‹Œåœ¨ä¸€èµ·åƒã€‚" },
            { name: "æ³°å¼æ–™ç†", cat: "æ³°å¼", price: 2, heavy: false, soup: true, spicy: true, img: "https://images.unsplash.com/photo-1559314809-0d155014e29e?w=600", desc: "é…¸è¾£é–‹èƒƒï¼Œæœˆäº®è¦é¤…å¿…é»ã€‚" },
            { name: "è¶Šå—æ²³ç²‰", cat: "è¶Šå¼", price: 1, heavy: false, soup: true, spicy: false, img: "https://images.unsplash.com/photo-1582878826629-29b7ad1cdc43?w=600", desc: "æ¸…ç”œæ¹¯é ­é…ä¸Šæ»‘é †æ²³ç²‰ï¼Œæ¸…çˆ½é¸æ“‡ã€‚" },
            { name: "å°ç± åŒ…", cat: "ä¸­å¼", price: 3, heavy: false, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1563245372-f21724e3856d?w=600", desc: "çš®è–„æ±å¤šï¼Œæ­é…è–‘çµ²é†‹ä¸€å£å’¬ä¸‹ã€‚" },
            { name: "æ¸¯å¼é£²èŒ¶", cat: "æ¸¯å¼", price: 2, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1541696490865-e6f720e9c195?w=600", desc: "ç‡’è³£ã€è¦é¤ƒã€å‰ç‡’åŒ…ï¼Œæ¨£æ¨£éƒ½ä¾†ä¸€é»ã€‚" },
            { name: "ç‡’è‡˜ä¾¿ç•¶", cat: "æ¸¯å¼", price: 1, heavy: true, soup: false, spicy: false, img: "https://images.unsplash.com/photo-1552611052-33e04de081de?w=600", desc: "æ²¹é›ã€ç‡’é´¨ã€å‰ç‡’ï¼Œé…ä¸Šè”¥æ²¹æœ€ä¸‹é£¯ã€‚" },
            { name: "å°åº¦å’–å“©", cat: "ç•°åœ‹", price: 2, heavy: true, soup: true, spicy: true, img: "https://images.unsplash.com/photo-1604152135912-04a022e23696?w=600", desc: "é¦™æ–™å‘³æ¿ƒéƒï¼Œé…çƒ¤é¤…ä¸€çµ•ã€‚" }
        ];

        // === é‚è¼¯å€ ===
        let pool = [...database];
        let currentItem = null;
        let wishlist = []; 
        const MAX_WISH = 3;

        // åˆå§‹åŒ–
        setTimeout(() => {
            document.getElementById('loading').classList.add('hide');
            renderCard();
        }, 1000);

        function renderCard() {
            if (pool.length === 0) {
                alert("é¸é …éƒ½çœ‹å®Œäº†ï¼é‡æ–°æ´—ç‰Œ...");
                pool = [...database];
            }

            // éš¨æ©ŸæŠ½ä¸€å¼µ
            const idx = Math.floor(Math.random() * pool.length);
            currentItem = pool[idx];

            // å¡«å…¥è³‡æ–™
            document.getElementById('fImg').src = currentItem.img;
            document.getElementById('fName').innerText = currentItem.name;
            document.getElementById('fDesc').innerText = currentItem.desc;
            
            // æ¨™ç±¤
            let tagsHtml = `<span class="info-tag">${currentItem.cat}</span>`;
            if(currentItem.heavy) tagsHtml += `<span class="info-tag">é£½è¶³</span>`;
            if(!currentItem.heavy) tagsHtml += `<span class="info-tag">è¼•é£Ÿ</span>`;
            if(currentItem.soup) tagsHtml += `<span class="info-tag">æœ‰æ¹¯</span>`;
            if(currentItem.spicy) tagsHtml += `<span class="info-tag">è¾£</span>`;
            document.getElementById('fTags').innerHTML = tagsHtml;

            // åƒ¹æ ¼
            let pStr = "";
            for(let i=0; i<3; i++) pStr += i < currentItem.price ? "â˜…" : "â˜†";
            document.getElementById('fPrice').innerText = pStr;

            // è§¸ç™¼å‹•ç•«
            const card = document.getElementById('cardContainer');
            card.style.animation = 'none';
            card.offsetHeight; 
            card.style.animation = 'popIn 0.3s';
        }

        // æ›ä¸€å¼µ (ä¸å–œæ­¡)
        function nextCard() {
            renderCard();
        }

        // åŠ å…¥å€™é¸ (å–œæ­¡)
        function addToWishlist() {
            if (wishlist.some(i => i.name === currentItem.name)) {
                alert("å·²ç¶“åœ¨æ¸…å–®è£¡å›‰ï¼");
                nextCard();
                return;
            }

            wishlist.push(currentItem);
            updateCounter();

            // å¾ pool ç§»é™¤
            pool = pool.filter(i => i.name !== currentItem.name);

            // æª¢æŸ¥æ˜¯å¦é›†æ»¿
            if (wishlist.length >= MAX_WISH) {
                showShortlist();
            } else {
                nextCard();
            }
        }

        function updateCounter() {
            const counter = document.getElementById('wishCounter');
            counter.innerText = `â¤ï¸ ${wishlist.length} / ${MAX_WISH}`;
            counter.classList.add('bump');
            setTimeout(() => counter.classList.remove('bump'), 200);
        }

        // éæ¿¾å™¨
        function filterOut(reason) {
            pool = pool.filter(i => i.name !== currentItem.name);

            if (reason === 'cat') {
                pool = pool.filter(i => i.cat !== currentItem.cat);
            } else if (reason === 'heavy') {
                pool = pool.filter(i => !i.heavy);
            } else if (reason === 'spicy') {
                pool = pool.filter(i => !i.spicy);
            } else if (reason === 'expensive') {
                pool = pool.filter(i => i.price < currentItem.price);
            }
            renderCard();
        }

        // === æ±ºé¸æ¨¡å¼ ===
        function showShortlist() {
            document.getElementById('browseMode').style.display = 'none';
            document.getElementById('shortlistMode').classList.add('show');
            
            const container = document.getElementById('pkList');
            container.innerHTML = wishlist.map((item, idx) => `
                <div class="pk-card" onclick="finalDecide(${idx})">
                    <img src="${item.img}" class="pk-img">
                    <div class="pk-info">
                        <div class="pk-name">${item.name}</div>
                        <div class="pk-meta">${item.desc}</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color:#ddd;"></i>
                </div>
            `).join('');
        }

        // æœ€çµ‚é¸æ“‡ (æ‰‹å‹•é»é¸)
        function finalDecide(idx) {
            showSuccess(wishlist[idx]);
        }

        // å¹«æˆ‘é¸ (éš¨æ©Ÿ)
        function randomPickFinal() {
            const idx = Math.floor(Math.random() * wishlist.length);
            let count = 0;
            const interval = setInterval(() => {
                const cards = document.querySelectorAll('.pk-card');
                cards.forEach(c => c.classList.remove('selected'));
                cards[count % cards.length].classList.add('selected');
                count++;
                if (count > 10) {
                    clearInterval(interval);
                    setTimeout(() => showSuccess(wishlist[idx]), 500);
                }
            }, 100);
        }

        function showSuccess(item) {
            document.getElementById('successOverlay').classList.add('show');
            document.getElementById('finalImg').src = item.img;
            document.getElementById('finalName').innerText = item.name;
            
            const q = encodeURIComponent(item.name + " é™„è¿‘");
            document.getElementById('mapLink').href = `https://www.google.com/maps/search/?api=1\&query=Naples+Airport{q}`;
        }

    </script>
</body>
</html>